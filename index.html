<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ecoinvent ã‚¢ãƒ«ãƒŸãƒ‹ã‚¦ãƒ ã‚«ãƒ†ã‚´ãƒªéšå±¤å›³</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        @media (max-width: 1200px) {
            .container {
                max-width: 95%;
                padding: 20px;
            }
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 15px;
                border-radius: 10px;
            }
        }
        
        .title {
            text-align: center;
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 20px;
            color: #333;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        
        .breadcrumb {
            text-align: center;
            margin-bottom: 20px;
            padding: 10px;
            background: rgba(52, 73, 94, 0.1);
            border-radius: 10px;
        }
        
        .breadcrumb-item {
            display: inline;
            color: #2c3e50;
            font-weight: 500;
        }
        
        .breadcrumb-item:not(:last-child)::after {
            content: " > ";
            color: #7f8c8d;
            margin: 0 8px;
        }
        
        .breadcrumb-item.clickable {
            cursor: pointer;
            color: #3498db;
            text-decoration: underline;
        }
        
        .breadcrumb-item.clickable:hover {
            color: #2980b9;
        }
        
        .main-area {
            position: relative;
            width: 100%;
            height: 1200px;
            background: linear-gradient(45deg, #f8f9fa, #e9ecef);
            border: 3px solid #333;
            border-radius: 20px;
            margin: 0 auto;
            overflow: hidden;
            transition: all 0.5s ease;
        }
        
        @media (max-width: 1200px) {
            .main-area {
                height: 1000px;
            }
        }
        
        @media (max-width: 768px) {
            .main-area {
                height: 1400px;
                border: 2px solid #333;
            }
        }
        
        .main-title {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 24px;
            font-weight: bold;
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
            z-index: 100;
        }
        
        .info-panel-top {
            position: absolute;
            top: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.95);
            padding: 15px 25px;
            border-radius: 12px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
            max-width: 600px;
            min-width: 400px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.3);
            z-index: 100;
        }
        
        .area {
            position: absolute;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid rgba(255,255,255,0.3);
        }
        
        @media (max-width: 768px) {
            .area {
                padding: 15px;
                border-radius: 10px;
                min-width: 250px !important;
                min-height: 200px !important;
            }
        }
        
        .area:hover {
            transform: scale(1.05);
            box-shadow: 0 12px 35px rgba(0,0,0,0.25);
            z-index: 50;
            border: 3px solid rgba(255,255,255,0.8);
        }
        
        .area.info-hover {
            border: 2px solid rgba(52, 152, 219, 0.8);
            box-shadow: 0 0 20px rgba(52, 152, 219, 0.3);
        }
        
        .area.clickable::after {
            content: "ğŸ“± ã‚¯ãƒªãƒƒã‚¯ã§è©³ç´°";
            position: absolute;
            top: 5px;
            right: 10px;
            font-size: 12px;
            color: rgba(255,255,255,0.8);
            background: rgba(0,0,0,0.3);
            padding: 2px 8px;
            border-radius: 10px;
        }
        
        .area-title {
            font-size: 18px;
            font-weight: bold;
            color: white;
            margin-bottom: 15px;
            text-align: center;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            line-height: 1.2;
        }
        
        @media (max-width: 768px) {
            .area-title {
                font-size: 16px;
                margin-bottom: 12px;
            }
        }
        
        .area-content {
            background: rgba(255,255,255,0.9);
            border-radius: 10px;
            padding: 15px;
            height: calc(100% - 80px);
            overflow-y: auto;
        }
        
        .sub-item {
            background: linear-gradient(135deg, #fff, #f8f9fa);
            margin: 8px 0;
            padding: 12px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            color: #333;
            border-left: 4px solid #007bff;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: all 0.2s ease;
            line-height: 1.4;
        }
        
        @media (max-width: 768px) {
            .sub-item {
                font-size: 13px;
                padding: 10px;
                margin: 6px 0;
            }
        }
        
        .sub-item:hover {
            transform: translateX(5px);
            border-left-color: #ffc107;
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
        }
        
        .info-title {
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
            font-size: 16px;
            border-bottom: 2px solid #007bff;
            padding-bottom: 5px;
        }
        
        .info-text {
            font-size: 14px;
            line-height: 1.6;
            color: #555;
        }
        
        @media (max-width: 768px) {
            .info-text {
                font-size: 13px;
            }
        }
        
        .legend {
            position: fixed;
            bottom: 30px;
            left: 30px;
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.3);
            max-width: 250px;
        }
        
        @media (max-width: 768px) {
            .legend {
                bottom: 20px;
                left: 20px;
                padding: 15px;
                max-width: 200px;
                border-radius: 10px;
            }
        }
        
        .legend-title {
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
            border-bottom: 2px solid #007bff;
            padding-bottom: 5px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin: 8px 0;
        }
        
        .legend-color {
            width: 25px;
            height: 25px;
            margin-right: 12px;
            border-radius: 6px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }
        
        .legend-text {
            font-size: 13px;
            color: #333;
            font-weight: 500;
        }
        
        .back-button {
            position: fixed;
            top: 30px;
            left: 30px;
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 8px 20px rgba(231, 76, 60, 0.3);
            transition: all 0.3s ease;
            display: none;
            z-index: 200;
        }
        
        .back-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 30px rgba(231, 76, 60, 0.4);
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 8px 25px rgba(0,0,0,0.15); }
            50% { box-shadow: 0 12px 35px rgba(0,0,0,0.25); }
            100% { box-shadow: 0 8px 25px rgba(0,0,0,0.15); }
        }
        
        .area.active {
            animation: pulse 2s infinite;
        }
        
        .fade-transition {
            opacity: 0;
            transition: opacity 0.5s ease;
        }
        
        .fade-transition.active {
            opacity: 1;
        }
        
        .clickable-sub-item {
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .clickable-sub-item:hover {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb) !important;
            transform: translateX(8px);
            border-left-color: #2196f3 !important;
            box-shadow: 0 4px 12px rgba(33, 150, 243, 0.3);
        }
        
        .clickable-sub-item::after {
            content: "ğŸ“‹ ã‚¯ãƒªãƒƒã‚¯ã§è©³ç´°";
            position: absolute;
            top: 2px;
            right: 8px;
            font-size: 10px;
            color: rgba(0,0,0,0.5);
            background: rgba(255,255,255,0.8);
            padding: 1px 6px;
            border-radius: 8px;
            opacity: 0;
            transition: opacity 0.2s ease;
        }
        
        .clickable-sub-item:hover::after {
            opacity: 1;
        }
        
        /* ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚¹ã‚¿ã‚¤ãƒ« */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            backdrop-filter: blur(5px);
        }
        
        /* é¡ä¼¼åº¦æ¤œç´¢ã‚¹ã‚¿ã‚¤ãƒ« */
        .similarity-search-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            border-radius: 20px;
            padding: 8px 16px;
            font-size: 13px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
            transition: all 0.3s ease;
            z-index: 10;
        }
        
        .similarity-search-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(52, 152, 219, 0.4);
        }
        
        /* é¡ä¼¼åº¦è¡¨ç¤ºãƒãƒƒã‚¸ */
        .similarity-badge {
            position: absolute;
            top: 5px;
            left: 5px;
            background: white;
            border-radius: 15px;
            padding: 4px 10px;
            font-size: 12px;
            font-weight: bold;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            z-index: 5;
        }
        
        .similarity-high {
            color: #27ae60;
            border: 2px solid #27ae60;
        }
        
        .similarity-medium {
            color: #f39c12;
            border: 2px solid #f39c12;
        }
        
        .similarity-low {
            color: #e74c3c;
            border: 2px solid #e74c3c;
        }
        
        /* é¡ä¼¼åº¦æ¤œç´¢ãƒ¢ãƒ¼ãƒ€ãƒ« */
        .similarity-modal {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 900px;
            max-height: 85vh;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow-y: auto;
        }
        
        .similarity-input-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 25px;
        }
        
        .similarity-input-group {
            margin-bottom: 15px;
        }
        
        .similarity-input-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
        }
        
        .similarity-input-group input,
        .similarity-input-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        
        .similarity-results {
            margin-top: 20px;
        }
        
        .similarity-result-item {
            background: linear-gradient(135deg, #fff, #f8f9fa);
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            position: relative;
            transition: all 0.3s ease;
        }
        
        .similarity-result-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }
        
        .similarity-score {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 24px;
            font-weight: bold;
        }
        
        .similarity-details {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #e0e0e0;
        }
        
        .similarity-chart {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .similarity-chart-label {
            width: 120px;
            font-size: 13px;
            color: #666;
        }
        
        .similarity-chart-bar {
            flex: 1;
            height: 20px;
            background: #e0e0e0;
            border-radius: 10px;
            margin: 0 10px;
            position: relative;
            overflow: hidden;
        }
        
        .similarity-chart-fill {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #2ecc71);
            border-radius: 10px;
            transition: width 0.5s ease;
        }
        
        .similarity-chart-value {
            font-size: 13px;
            font-weight: bold;
            color: #333;
        }
        
        .modal {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 800px;
            max-height: 80vh;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 15px;
        }
        
        .modal-title {
            font-size: 24px;
            font-weight: bold;
            color: #333;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: #666;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.2s ease;
        }
        
        .modal-close:hover {
            background: rgba(0,0,0,0.1);
            color: #333;
        }
        
        .activity-list {
            display: grid;
            gap: 12px;
        }
        
        .activity-item {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            transition: all 0.2s ease;
        }
        
        .activity-item:hover {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            border-color: #2196f3;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(33, 150, 243, 0.2);
        }
        
        .activity-id {
            font-family: 'Courier New', monospace;
            font-weight: bold;
            color: #1976d2;
            font-size: 14px;
            margin-bottom: 8px;
        }
        
        .activity-name {
            color: #333;
            font-size: 16px;
            margin-bottom: 6px;
            font-weight: 500;
        }
        
        .activity-description {
            color: #666;
            font-size: 13px;
            line-height: 1.4;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="title">ecoinvent ã‚¢ãƒ«ãƒŸãƒ‹ã‚¦ãƒ ã‚«ãƒ†ã‚´ãƒªã‚¨ãƒªã‚¢å›³</div>
        
        <!-- æŠ½è±¡æ¤œç´¢ãƒãƒ¼ -->
        <div class="abstract-search-container" id="abstractSearchContainer">
            <div class="abstract-search-input-wrapper">
                <input type="text" id="abstractSearchInput" placeholder="ä¾‹: æ—¥æœ¬ã®é›»åŠ›ã€ã‚¢ã‚¸ã‚¢ã®ã‚¢ãƒ«ãƒŸãƒ‹ã‚¦ãƒ ç”Ÿç”£ã€etc." class="abstract-search-input">
                <button onclick="performAbstractSearch()" class="abstract-search-btn">ğŸ” æ¤œç´¢</button>
            </div>
            <div class="abstract-search-suggestions" id="searchSuggestions">
                <!-- æ¤œç´¢å€™è£œãŒå‹•çš„ã«è¡¨ç¤ºã•ã‚Œã‚‹ -->
            </div>
        </div>
        
        <!-- ãƒ‘ãƒ³ããšãƒŠãƒ“ -->
        <div class="breadcrumb" id="breadcrumb">
            <span class="breadcrumb-item">ã‚¢ãƒ«ãƒŸãƒ‹ã‚¦ãƒ å…¨ä½“</span>
        </div>
        
        <!-- æˆ»ã‚‹ãƒœã‚¿ãƒ³ -->
        <div class="back-button" id="backButton" onclick="goBack()">â† æˆ»ã‚‹</div>
        
        <div class="main-area fade-transition active" id="mainArea">
            <div class="main-title" id="mainTitle">ã‚¢ãƒ«ãƒŸãƒ‹ã‚¦ãƒ å…¨ä½“é ˜åŸŸ (Aluminum Domain)</div>
            
            <!-- ä¸Šéƒ¨æƒ…å ±ãƒ‘ãƒãƒ« -->
            <div class="info-panel-top" id="infoPanelTop">
                <div class="info-title">ã‚¨ãƒªã‚¢æƒ…å ±</div>
                <div class="info-text" id="infoContentTop">
                    å„ã‚¨ãƒªã‚¢ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦è©³ç´°æƒ…å ±ã‚’è¡¨ç¤ºã™ã‚‹ã‹ã€è©³ç´°ã‚¨ãƒªã‚¢ã«ç§»å‹•ã—ã¦ãã ã•ã„ã€‚<br>
                    ã“ã®å›³ã¯ã€ecoinventãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ãŠã‘ã‚‹ã‚¢ãƒ«ãƒŸãƒ‹ã‚¦ãƒ é–¢é€£ãƒ—ãƒ­ã‚»ã‚¹ã‚’åœ°ç†çš„ã‚¨ãƒªã‚¢ã®ã‚ˆã†ã«è¡¨ç¾ã—ã€
                    ãã‚Œãã‚Œã®é ˜åŸŸå†…ã«é–¢é€£ã™ã‚‹ãƒ—ãƒ­ã‚»ã‚¹ã‚„ã‚«ãƒ†ã‚´ãƒªã‚’ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã—ã¦ã„ã¾ã™ã€‚
                </div>
            </div>
            
            <!-- å‹•çš„ã«ã‚¨ãƒªã‚¢ãŒç”Ÿæˆã•ã‚Œã‚‹å ´æ‰€ -->
            <div id="areasContainer"></div>
        </div>
        
        <!-- å‡¡ä¾‹ -->
        <div class="legend">
            <div class="legend-title">ã‚¨ãƒªã‚¢åˆ†é¡</div>
            <div id="legendContent">
                <!-- å‹•çš„ã«ç”Ÿæˆ -->
            </div>
        </div>
    </div>
    
    <!-- Activity ID ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div class="modal-overlay" id="activityModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">Activity ID ä¸€è¦§</h2>
                <button class="modal-close" onclick="closeActivityModal()">&times;</button>
            </div>
            <div class="activity-list" id="activityList">
                <!-- å‹•çš„ã«ç”Ÿæˆã•ã‚Œã‚‹ -->
            </div>
        </div>
    </div>
    
    <!-- é¡ä¼¼åº¦æ¤œç´¢ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div class="modal-overlay" id="similarityModal">
        <div class="similarity-modal">
            <div class="modal-header">
                <h2 class="modal-title" id="similarityModalTitle">é¡ä¼¼ãƒ—ãƒ­ã‚»ã‚¹æ¤œç´¢</h2>
                <button class="modal-close" onclick="closeSimilarityModal()">&times;</button>
            </div>
            
            <div class="similarity-input-section">
                <h3>æ¢ã—ã¦ã„ã‚‹æ¡æ˜æ–¹æ³•ã®è©³ç´°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</h3>
                <div class="similarity-input-group">
                    <label>æ¡æ˜æ–¹æ³•å:</label>
                    <input type="text" id="miningMethodName" placeholder="ä¾‹: æµ·åº•æ¡æ˜ã€æº¶æ¶²æ¡æ˜ã€etc.">
                </div>
                <div class="similarity-input-group">
                    <label>æ¡æ˜æ·±åº¦:</label>
                    <select id="miningDepth">
                        <option value="surface">åœ°è¡¨ä»˜è¿‘ï¼ˆ0-50mï¼‰</option>
                        <option value="shallow">æµ…å±¤ï¼ˆ50-200mï¼‰</option>
                        <option value="deep">æ·±å±¤ï¼ˆ200mä»¥ä¸Šï¼‰</option>
                        <option value="underwater">æ°´ä¸­ãƒ»æµ·åº•</option>
                    </select>
                </div>
                <div class="similarity-input-group">
                    <label>æ¡æ˜è¦æ¨¡:</label>
                    <select id="miningScale">
                        <option value="small">å°è¦æ¨¡</option>
                        <option value="medium">ä¸­è¦æ¨¡</option>
                        <option value="large">å¤§è¦æ¨¡</option>
                    </select>
                </div>
                <button onclick="searchSimilarProcesses()" style="background: linear-gradient(135deg, #3498db, #2980b9); color: white; border: none; padding: 12px 24px; border-radius: 5px; cursor: pointer; font-weight: bold; margin-top: 10px;">é¡ä¼¼ãƒ—ãƒ­ã‚»ã‚¹ã‚’æ¤œç´¢</button>
            </div>
            
            <div class="similarity-results" id="similarityResults">
                <!-- æ¤œç´¢çµæœãŒå‹•çš„ã«è¡¨ç¤ºã•ã‚Œã‚‹ -->
            </div>
        </div>
    </div>
    
    <script>
        // éšå±¤ãƒ‡ãƒ¼ã‚¿å®šç¾©
        const areaHierarchy = {
            "main": {
                "title": "ã‚¢ãƒ«ãƒŸãƒ‹ã‚¦ãƒ å…¨ä½“é ˜åŸŸ (Aluminum Domain)",
                "areas": {
                    "primary_production": {
                        "name": "ä¸€æ¬¡ã‚¢ãƒ«ãƒŸãƒ‹ã‚¦ãƒ ç”Ÿç”£ã‚¨ãƒªã‚¢",
                        "color": "linear-gradient(135deg, #ff6b6b, #ee5a24)",
                        "position": {"top": 170, "left": 30, "width": 280, "height": 250},
                        "sub_items": [
                            "ãƒœãƒ¼ã‚­ã‚µã‚¤ãƒˆæ¡æ˜ãƒ—ãƒ­ã‚»ã‚¹",
                            "ã‚¢ãƒ«ãƒŸãƒŠç²¾è£½ãƒ—ãƒ­ã‚»ã‚¹", 
                            "é›»è§£è£½éŒ¬ãƒ—ãƒ­ã‚»ã‚¹",
                            "åœ°åŸŸåˆ¥ç”Ÿç”£ (ä¸­å›½)",
                            "åœ°åŸŸåˆ¥ç”Ÿç”£ (æ¬§å·)",
                            "åœ°åŸŸåˆ¥ç”Ÿç”£ (åŒ—ç±³)",
                            "åœ°åŸŸåˆ¥ç”Ÿç”£ (ãã®ä»–)"
                        ],
                        "has_detail": true,
                        "legend_color": "#ff6b6b"
                    },
                    "secondary_production": {
                        "name": "äºŒæ¬¡ã‚¢ãƒ«ãƒŸãƒ‹ã‚¦ãƒ ç”Ÿç”£ã‚¨ãƒªã‚¢",
                        "color": "linear-gradient(135deg, #4ecdc4, #00b894)",
                        "position": {"top": 170, "right": 30, "width": 280, "height": 250},
                        "sub_items": [
                            "ã‚¢ãƒ«ãƒŸã‚¹ã‚¯ãƒ©ãƒƒãƒ—å›å",
                            "ã‚¹ã‚¯ãƒ©ãƒƒãƒ—å‰å‡¦ç†",
                            "æº¶è§£ãƒ»ç²¾è£½ãƒ—ãƒ­ã‚»ã‚¹",
                            "å†ç”Ÿã‚¤ãƒ³ã‚´ãƒƒãƒˆè£½é€ ",
                            "å“è³ªç®¡ç†ãƒ»åˆ†æ",
                            "ãƒªã‚µã‚¤ã‚¯ãƒ«åŠ¹ç‡è©•ä¾¡"
                        ],
                        "has_detail": true,
                        "legend_color": "#4ecdc4"
                    },
                    "alloys": {
                        "name": "ã‚¢ãƒ«ãƒŸãƒ‹ã‚¦ãƒ åˆé‡‘ã‚¨ãƒªã‚¢", 
                        "color": "linear-gradient(135deg, #ffeaa7, #fdcb6e)",
                        "position": {"top": 460, "left": "50%", "transform": "translateX(-50%)", "width": 320, "height": 220},
                        "sub_items": [
                            "1000ç³» (ç´”ã‚¢ãƒ«ãƒŸãƒ‹ã‚¦ãƒ ç³»)",
                            "2000ç³» (Al-Cuç³»åˆé‡‘)",
                            "3000ç³» (Al-Mnç³»åˆé‡‘)", 
                            "5000ç³» (Al-Mgç³»åˆé‡‘)",
                            "6000ç³» (Al-Mg-Siç³»åˆé‡‘)",
                            "7000ç³» (Al-Znç³»åˆé‡‘)"
                        ],
                        "has_detail": true,
                        "legend_color": "#ffeaa7"
                    },
                    "processing": {
                        "name": "ã‚¢ãƒ«ãƒŸãƒ‹ã‚¦ãƒ åŠ å·¥ã‚¨ãƒªã‚¢",
                        "color": "linear-gradient(135deg, #45b7d1, #0984e3)",
                        "position": {"top": 720, "left": 30, "width": 320, "height": 260},
                        "sub_items": [
                            "åœ§å»¶åŠ å·¥ (æ¿æè£½é€ )",
                            "åœ§å»¶åŠ å·¥ (ç®”è£½é€ )",
                            "æŠ¼å‡ºæˆå½¢ (å½¢æè£½é€ )",
                            "é›é€ åŠ å·¥ (é«˜å¼·åº¦éƒ¨å“)",
                            "é‹³é€ åŠ å·¥ (è¤‡é›‘å½¢çŠ¶)",
                            "è¡¨é¢å‡¦ç† (é™½æ¥µé…¸åŒ–)",
                            "æ©Ÿæ¢°åŠ å·¥ (åˆ‡å‰Šãƒ»ç ”ç£¨)",
                            "æº¶æ¥ãƒ»æ¥åˆãƒ—ãƒ­ã‚»ã‚¹"
                        ],
                        "has_detail": true,
                        "legend_color": "#45b7d1"
                    },
                    "products": {
                        "name": "ã‚¢ãƒ«ãƒŸãƒ‹ã‚¦ãƒ è£½å“ã‚¨ãƒªã‚¢",
                        "color": "linear-gradient(135deg, #96ceb4, #55a3ff)",
                        "position": {"top": 720, "right": 30, "width": 320, "height": 260},
                        "sub_items": [
                            "å»ºç¯‰ææ–™ (çª“æ ãƒ»å¤–è£…)",
                            "å»ºç¯‰ææ–™ (æ§‹é€ æ)",
                            "è¼¸é€ç”¨ (è‡ªå‹•è»Šéƒ¨å“)",
                            "è¼¸é€ç”¨ (èˆªç©ºæ©Ÿéƒ¨å“)",
                            "åŒ…è£…ææ–™ (ç¼¶ãƒ»å®¹å™¨)",
                            "åŒ…è£…ææ–™ (ç®”ãƒ»ãƒ•ã‚£ãƒ«ãƒ )",
                            "é›»å­éƒ¨å“ (æ”¾ç†±å™¨)",
                            "é›»å­éƒ¨å“ (ç­ä½“ãƒ»ã‚³ãƒã‚¯ã‚¿)"
                        ],
                        "has_detail": true,
                        "legend_color": "#96ceb4"
                    }
                }
            },
            
            // ä¸€æ¬¡ç”Ÿç”£ã‚¨ãƒªã‚¢ã®è©³ç´°
            "primary_production": {
                "title": "ä¸€æ¬¡ã‚¢ãƒ«ãƒŸãƒ‹ã‚¦ãƒ ç”Ÿç”£ã‚¨ãƒªã‚¢è©³ç´°",
                "parent": "main",
                "areas": {
                    "bauxite_mining": {
                        "name": "ãƒœãƒ¼ã‚­ã‚µã‚¤ãƒˆæ¡æ˜",
                        "color": "linear-gradient(135deg, #e74c3c, #c0392b)",
                        "position": {"top": 200, "left": 80, "width": 320, "height": 250},
                        "sub_items": [
                            "éœ²å¤©æ˜ã‚Šæ¡æ˜",
                            "åœ°ä¸‹æ¡æ˜",
                            "é‰±çŸ³å“è³ªç®¡ç†",
                            "ç’°å¢ƒå½±éŸ¿è©•ä¾¡",
                            "æ¡æ˜å¾Œå¾©æ—§"
                        ],
                        "has_detail": false,
                        "legend_color": "#e74c3c"
                    },
                    "alumina_refining": {
                        "name": "ã‚¢ãƒ«ãƒŸãƒŠç²¾è£½",
                        "color": "linear-gradient(135deg, #c0392b, #a93226)",
                        "position": {"top": 200, "right": 80, "width": 320, "height": 250},
                        "sub_items": [
                            "ãƒã‚¤ãƒ¤ãƒ¼æ³•ãƒ—ãƒ­ã‚»ã‚¹",
                            "èµ¤æ³¥å‡¦ç†",
                            "çµæ™¶åŒ–å·¥ç¨‹",
                            "ç„¼æˆå·¥ç¨‹",
                            "å“è³ªæ¤œæŸ»"
                        ],
                        "has_detail": false,
                        "legend_color": "#c0392b"
                    },
                    "electrolysis": {
                        "name": "é›»è§£è£½éŒ¬",
                        "color": "linear-gradient(135deg, #a93226, #922b21)",
                        "position": {"top": 500, "left": "50%", "transform": "translateX(-50%)", "width": 380, "height": 280},
                        "sub_items": [
                            "ãƒ›ãƒ¼ãƒ«ãƒ»ã‚¨ãƒ«ãƒ¼æ³•",
                            "é›»è§£æ§½ç®¡ç†",
                            "é™½æ¥µãƒ»é™°æ¥µç®¡ç†",
                            "é›»åŠ›ä¾›çµ¦ã‚·ã‚¹ãƒ†ãƒ ",
                            "æº¶èã‚¢ãƒ«ãƒŸãƒ‹ã‚¦ãƒ å‡¦ç†"
                        ],
                        "has_detail": false,
                        "legend_color": "#a93226"
                    }
                }
            },
            
            // äºŒæ¬¡ç”Ÿç”£ã‚¨ãƒªã‚¢ã®è©³ç´°
            "secondary_production": {
                "title": "äºŒæ¬¡ã‚¢ãƒ«ãƒŸãƒ‹ã‚¦ãƒ ç”Ÿç”£ã‚¨ãƒªã‚¢è©³ç´°",
                "parent": "main",
                "areas": {
                    "scrap_collection": {
                        "name": "ã‚¹ã‚¯ãƒ©ãƒƒãƒ—å›åã‚·ã‚¹ãƒ†ãƒ ",
                        "color": "linear-gradient(135deg, #17a2b8, #138496)",
                        "position": {"top": 170, "left": 50, "width": 280, "height": 220},
                        "sub_items": [
                            "å»ºç¯‰å»ƒæå›å",
                            "è‡ªå‹•è»Šè§£ä½“ã‚¹ã‚¯ãƒ©ãƒƒãƒ—",
                            "é£²æ–™ç¼¶å›å",
                            "ç”£æ¥­ã‚¹ã‚¯ãƒ©ãƒƒãƒ—",
                            "åˆ†åˆ¥ãƒ»ä»•åˆ†ã‘ã‚·ã‚¹ãƒ†ãƒ "
                        ],
                        "has_detail": false,
                        "legend_color": "#17a2b8"
                    },
                    "preprocessing": {
                        "name": "å‰å‡¦ç†å·¥ç¨‹",
                        "color": "linear-gradient(135deg, #138496, #0f6674)",
                        "position": {"top": 170, "right": 50, "width": 280, "height": 220},
                        "sub_items": [
                            "ç£æ°—åˆ†é›¢",
                            "æ¸¦é›»æµåˆ†é›¢",
                            "ç ´ç •ãƒ»è£æ–­",
                            "æ´—æµ„ãƒ»è„±è„‚",
                            "åˆé‡‘åˆ†åˆ¥"
                        ],
                        "has_detail": false,
                        "legend_color": "#138496"
                    },
                    "melting_refining": {
                        "name": "æº¶è§£ãƒ»ç²¾è£½ãƒ—ãƒ­ã‚»ã‚¹",
                        "color": "linear-gradient(135deg, #0f6674, #0a525a)",
                        "position": {"top": 420, "left": "50%", "transform": "translateX(-50%)", "width": 320, "height": 240},
                        "sub_items": [
                            "åå°„ç‚‰æº¶è§£",
                            "å›è»¢ç‚‰æº¶è§£",
                            "ãƒ•ãƒ©ãƒƒã‚¯ã‚¹å‡¦ç†",
                            "ã‚¬ã‚¹é™¤å»",
                            "ä»‹åœ¨ç‰©é™¤å»"
                        ],
                        "has_detail": false,
                        "legend_color": "#0f6674"
                    },
                    "quality_control": {
                        "name": "å“è³ªç®¡ç†ãƒ»åˆ†æ",
                        "color": "linear-gradient(135deg, #0a525a, #073e47)",
                        "position": {"top": 690, "left": 50, "width": 280, "height": 200},
                        "sub_items": [
                            "åŒ–å­¦æˆåˆ†åˆ†æ",
                            "æ©Ÿæ¢°ç‰¹æ€§è©¦é¨“",
                            "çµ„ç¹”è¦³å¯Ÿ",
                            "ä¸ç´”ç‰©æ¤œæŸ»",
                            "ãƒˆãƒ¬ãƒ¼ã‚µãƒ“ãƒªãƒ†ã‚£"
                        ],
                        "has_detail": false,
                        "legend_color": "#0a525a"
                    },
                    "secondary_ingot": {
                        "name": "å†ç”Ÿã‚¤ãƒ³ã‚´ãƒƒãƒˆè£½é€ ",
                        "color": "linear-gradient(135deg, #073e47, #042a2f)",
                        "position": {"top": 690, "right": 50, "width": 280, "height": 200},
                        "sub_items": [
                            "é‹³é€ æŠ€è¡“",
                            "å†·å´åˆ¶å¾¡",
                            "è¡¨é¢ä»•ä¸Šã’",
                            "å¯¸æ³•ç²¾åº¦ç®¡ç†",
                            "å‡ºè·æº–å‚™"
                        ],
                        "has_detail": false,
                        "legend_color": "#073e47"
                    }
                }
            }
        };
        
        // ç¾åœ¨ã®çŠ¶æ…‹ç®¡ç†
        let currentLevel = "main";
        let breadcrumb = ["ã‚¢ãƒ«ãƒŸãƒ‹ã‚¦ãƒ å…¨ä½“"];
        
        // ãƒ—ãƒ­ã‚»ã‚¹é¡ä¼¼åº¦ãƒ‡ãƒ¼ã‚¿
        const processSimilarityData = {
            "æ¡æ˜æ–¹æ³•": {
                "éœ²å¤©æ˜ã‚Šæ¡æ˜": {
                    characteristics: {
                        æ·±åº¦: "surface",
                        ç’°å¢ƒå½±éŸ¿: 80,
                        ã‚³ã‚¹ãƒˆ: 60,
                        ç”Ÿç”£åŠ¹ç‡: 90,
                        å®‰å…¨æ€§: 85,
                        ã‚¨ãƒãƒ«ã‚®ãƒ¼æ¶ˆè²»: 70
                    }
                },
                "åœ°ä¸‹æ¡æ˜": {
                    characteristics: {
                        æ·±åº¦: "deep",
                        ç’°å¢ƒå½±éŸ¿: 40,
                        ã‚³ã‚¹ãƒˆ: 90,
                        ç”Ÿç”£åŠ¹ç‡: 60,
                        å®‰å…¨æ€§: 50,
                        ã‚¨ãƒãƒ«ã‚®ãƒ¼æ¶ˆè²»: 85
                    }
                }
            }
        };
        
        // é¡ä¼¼åº¦è¨ˆç®—é–¢æ•°
        function calculateSimilarity(target, existing) {
            const weights = {
                æ·±åº¦: 0.25,
                ç’°å¢ƒå½±éŸ¿: 0.2,
                ã‚³ã‚¹ãƒˆ: 0.2,
                ç”Ÿç”£åŠ¹ç‡: 0.15,
                å®‰å…¨æ€§: 0.1,
                ã‚¨ãƒãƒ«ã‚®ãƒ¼æ¶ˆè²»: 0.1
            };
            
            let totalScore = 0;
            let details = {};
            
            // æ·±åº¦ã®é¡ä¼¼åº¦
            const depthScore = target.æ·±åº¦ === existing.characteristics.æ·±åº¦ ? 100 : 
                              (target.æ·±åº¦ === "shallow" && existing.characteristics.æ·±åº¦ === "surface") ? 70 : 
                              (target.æ·±åº¦ === "underwater" && existing.characteristics.æ·±åº¦ === "surface") ? 30 : 50;
            
            details.æ·±åº¦ = depthScore;
            totalScore += depthScore * weights.æ·±åº¦;
            
            // ãã®ä»–ã®ç‰¹æ€§ï¼ˆä»®ã®å€¤ï¼‰
            const otherScores = {
                ç’°å¢ƒå½±éŸ¿: Math.max(0, 100 - Math.abs(target.ç’°å¢ƒå½±éŸ¿ - existing.characteristics.ç’°å¢ƒå½±éŸ¿)),
                ã‚³ã‚¹ãƒˆ: Math.max(0, 100 - Math.abs(target.ã‚³ã‚¹ãƒˆ - existing.characteristics.ã‚³ã‚¹ãƒˆ)),
                ç”Ÿç”£åŠ¹ç‡: Math.max(0, 100 - Math.abs(target.ç”Ÿç”£åŠ¹ç‡ - existing.characteristics.ç”Ÿç”£åŠ¹ç‡)),
                å®‰å…¨æ€§: Math.max(0, 100 - Math.abs(target.å®‰å…¨æ€§ - existing.characteristics.å®‰å…¨æ€§)),
                ã‚¨ãƒãƒ«ã‚®ãƒ¼æ¶ˆè²»: Math.max(0, 100 - Math.abs(target.ã‚¨ãƒãƒ«ã‚®ãƒ¼æ¶ˆè²» - existing.characteristics.ã‚¨ãƒãƒ«ã‚®ãƒ¼æ¶ˆè²»))
            };
            
            Object.keys(otherScores).forEach(key => {
                details[key] = otherScores[key];
                totalScore += otherScores[key] * weights[key];
            });
            
            return {
                total: Math.round(totalScore),
                details: details
            };
        }
        
        // Activity ID ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿
        const activityData = {
            "éœ²å¤©æ˜ã‚Šæ¡æ˜": {
                title: "éœ²å¤©æ˜ã‚Šæ¡æ˜ - Activity ID ä¸€è¦§",
                activities: [
                    {
                        id: "bauxite_mining_openpit_001",
                        name: "ãƒœãƒ¼ã‚­ã‚µã‚¤ãƒˆæ¡æ˜ï¼ˆéœ²å¤©æ˜ã‚Šã€ã‚ªãƒ¼ã‚¹ãƒˆãƒ©ãƒªã‚¢ï¼‰",
                        description: "ã‚ªãƒ¼ã‚¹ãƒˆãƒ©ãƒªã‚¢ã«ãŠã‘ã‚‹ãƒœãƒ¼ã‚­ã‚µã‚¤ãƒˆé‰±çŸ³ã®éœ²å¤©æ¡æ˜ãƒ—ãƒ­ã‚»ã‚¹ã€‚å¤§å‹é‡æ©Ÿã‚’ä½¿ç”¨ã—ãŸè¡¨åœŸå‰¥é›¢ã¨æ¡æ˜ä½œæ¥­ã‚’å«ã‚€ã€‚"
                    },
                    {
                        id: "bauxite_mining_openpit_002", 
                        name: "ãƒœãƒ¼ã‚­ã‚µã‚¤ãƒˆæ¡æ˜ï¼ˆéœ²å¤©æ˜ã‚Šã€ãƒ–ãƒ©ã‚¸ãƒ«ï¼‰",
                        description: "ãƒ–ãƒ©ã‚¸ãƒ«ã‚¢ãƒã‚¾ãƒ³åœ°åŸŸã§ã®ãƒœãƒ¼ã‚­ã‚µã‚¤ãƒˆæ¡æ˜ã€‚ç’°å¢ƒé…æ…®å‹ã®æ¡æ˜æ‰‹æ³•ã¨åœŸåœ°å¾©æ—§ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’å«ã‚€ã€‚"
                    },
                    {
                        id: "bauxite_mining_openpit_003",
                        name: "ãƒœãƒ¼ã‚­ã‚µã‚¤ãƒˆæ¡æ˜ï¼ˆéœ²å¤©æ˜ã‚Šã€ã‚®ãƒ‹ã‚¢ï¼‰",
                        description: "è¥¿ã‚¢ãƒ•ãƒªã‚«ã‚®ãƒ‹ã‚¢ã§ã®é«˜å“ä½ãƒœãƒ¼ã‚­ã‚µã‚¤ãƒˆæ¡æ˜ã€‚æ¸¯æ¹¾è¼¸é€ã‚¤ãƒ³ãƒ•ãƒ©ã¨ã®çµ±åˆãƒ—ãƒ­ã‚»ã‚¹ã€‚"
                    },
                    {
                        id: "bauxite_mining_openpit_004",
                        name: "ãƒœãƒ¼ã‚­ã‚µã‚¤ãƒˆæ¡æ˜ï¼ˆéœ²å¤©æ˜ã‚Šã€ã‚¸ãƒ£ãƒã‚¤ã‚«ï¼‰",
                        description: "ã‚«ãƒªãƒ–æµ·åœ°åŸŸã§ã®ä¸­å“ä½ãƒœãƒ¼ã‚­ã‚µã‚¤ãƒˆæ¡æ˜ã€‚å³¶å¶¼éƒ¨ç‰¹æœ‰ã®ç‰©æµåˆ¶ç´„ã‚’è€ƒæ…®ã—ãŸãƒ—ãƒ­ã‚»ã‚¹ã€‚"
                    },
                    {
                        id: "bauxite_mining_openpit_005",
                        name: "ãƒœãƒ¼ã‚­ã‚µã‚¤ãƒˆæ¡æ˜ï¼ˆéœ²å¤©æ˜ã‚Šã€ã‚¤ãƒ³ãƒ‰ï¼‰",
                        description: "ã‚¤ãƒ³ãƒ‰æ±éƒ¨ã§ã®å°è¦æ¨¡åˆ†æ•£å‹ãƒœãƒ¼ã‚­ã‚µã‚¤ãƒˆæ¡æ˜ã€‚åœ°åŸŸã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã¨ã®å”åƒæ¡æ˜ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã€‚"
                    }
                ]
            }
        };
        
        // ã‚¨ãƒªã‚¢è©³ç´°æƒ…å ±
        const areaInfo = {
            // ãƒ¡ã‚¤ãƒ³ãƒ¬ãƒ™ãƒ«
            primary: {
                title: 'ä¸€æ¬¡ã‚¢ãƒ«ãƒŸãƒ‹ã‚¦ãƒ ç”Ÿç”£ã‚¨ãƒªã‚¢',
                content: `<strong>åŸæ–™ã‹ã‚‰æ–°è¦ã‚¢ãƒ«ãƒŸãƒ‹ã‚¦ãƒ ã‚’ç”Ÿç”£ã™ã‚‹é ˜åŸŸ</strong><br>
                ã“ã®ã‚¨ãƒªã‚¢ã§ã¯ã€ãƒœãƒ¼ã‚­ã‚µã‚¤ãƒˆé‰±çŸ³ã‹ã‚‰é‡‘å±ã‚¢ãƒ«ãƒŸãƒ‹ã‚¦ãƒ ã¾ã§ã®å…¨å·¥ç¨‹ã‚’ç®¡ç†ã—ã¾ã™ã€‚
                ä¸»è¦ãƒ—ãƒ­ã‚»ã‚¹ï¼šãƒœãƒ¼ã‚­ã‚µã‚¤ãƒˆæ¡æ˜ã€ã‚¢ãƒ«ãƒŸãƒŠç²¾è£½ã€é›»è§£è£½éŒ¬ã€åœ°åŸŸåˆ¥æœ€é©åŒ–ã€‚
                ç’°å¢ƒè² è·ï¼šé«˜ã‚¨ãƒãƒ«ã‚®ãƒ¼æ¶ˆè²»ï¼ˆç´„15kWh/kgï¼‰`
            },
            secondary: {
                title: 'äºŒæ¬¡ã‚¢ãƒ«ãƒŸãƒ‹ã‚¦ãƒ ç”Ÿç”£ã‚¨ãƒªã‚¢',
                content: `<strong>ãƒªã‚µã‚¤ã‚¯ãƒ«ã‚¢ãƒ«ãƒŸãƒ‹ã‚¦ãƒ ã®ç”Ÿç”£é ˜åŸŸ</strong><br>
                ä½¿ç”¨æ¸ˆã¿ã‚¢ãƒ«ãƒŸãƒ‹ã‚¦ãƒ è£½å“ã‚’åŸæ–™ã¨ã—ã¦ã€æ–°ã—ã„ã‚¢ãƒ«ãƒŸãƒ‹ã‚¦ãƒ ã‚’ç”Ÿç”£ã™ã‚‹å¾ªç’°å‹ã‚¨ãƒªã‚¢ã§ã™ã€‚
                ä¸»è¦ãƒ—ãƒ­ã‚»ã‚¹ï¼šã‚¹ã‚¯ãƒ©ãƒƒãƒ—å›åã€å‰å‡¦ç†ã€æº¶è§£ç²¾è£½ã€å†ç”Ÿã‚¤ãƒ³ã‚´ãƒƒãƒˆè£½é€ ã€‚
                ç’°å¢ƒãƒ¡ãƒªãƒƒãƒˆï¼šä¸€æ¬¡ç”Ÿç”£æ¯”95%ã®ã‚¨ãƒãƒ«ã‚®ãƒ¼å‰Šæ¸›åŠ¹æœ`
            },
            alloys: {
                title: 'ã‚¢ãƒ«ãƒŸãƒ‹ã‚¦ãƒ åˆé‡‘ã‚¨ãƒªã‚¢',
                content: `<strong>ç”¨é€”åˆ¥åˆé‡‘è¨­è¨ˆãƒ»è£½é€ ã®ä¸­å¿ƒé ˜åŸŸ</strong><br>
                ç´”ã‚¢ãƒ«ãƒŸãƒ‹ã‚¦ãƒ ã«å„ç¨®å…ƒç´ ã‚’æ·»åŠ ã—ã¦ã€ç”¨é€”ã«å¿œã˜ãŸç‰¹æ€§ã‚’æŒã¤åˆé‡‘ã‚’è¨­è¨ˆãƒ»è£½é€ ã™ã‚‹ã‚¨ãƒªã‚¢ã§ã™ã€‚
                åˆé‡‘ç³»çµ±ï¼š1000ç³»ï¼ˆç´”åº¦99%ä»¥ä¸Šï¼‰ã€2000ç³»ï¼ˆéŠ…æ·»åŠ ã€é«˜å¼·åº¦ï¼‰ã€5000ç³»ï¼ˆãƒã‚°ãƒã‚·ã‚¦ãƒ æ·»åŠ ï¼‰ã€6000ç³»ï¼ˆæ§‹é€ æï¼‰ã€‚
                å“è³ªç®¡ç†ï¼šæˆåˆ†åˆ†æãƒ»æ©Ÿæ¢°ç‰¹æ€§è©¦é¨“ãƒ»çµ„ç¹”è¦³å¯Ÿ`
            },
            processing: {
                title: 'ã‚¢ãƒ«ãƒŸãƒ‹ã‚¦ãƒ åŠ å·¥ã‚¨ãƒªã‚¢',
                content: `<strong>ã‚¤ãƒ³ã‚´ãƒƒãƒˆã‹ã‚‰æœ€çµ‚å½¢çŠ¶ã¸ã®åŠ å·¥é ˜åŸŸ</strong><br>
                ã‚¢ãƒ«ãƒŸãƒ‹ã‚¦ãƒ ã‚¤ãƒ³ã‚´ãƒƒãƒˆã‚„åˆé‡‘ã‚’æ§˜ã€…ãªåŠ å·¥æŠ€è¡“ã«ã‚ˆã‚Šæœ€çµ‚è£½å“å½¢çŠ¶ã«æˆå½¢ã™ã‚‹ã‚¨ãƒªã‚¢ã§ã™ã€‚
                ä¸»è¦åŠ å·¥æŠ€è¡“ï¼šåœ§å»¶ï¼ˆæ¿æãƒ»ç®”ï¼‰ã€æŠ¼å‡ºï¼ˆè¤‡é›‘æ–­é¢å½¢æï¼‰ã€é›é€ ï¼ˆé«˜å¼·åº¦éƒ¨å“ï¼‰ã€é‹³é€ ï¼ˆè¤‡é›‘å½¢çŠ¶ï¼‰ã€è¡¨é¢å‡¦ç†ã€‚
                å“è³ªä¿è¨¼ï¼šå¯¸æ³•ç²¾åº¦ãƒ»è¡¨é¢å“è³ªãƒ»æ©Ÿæ¢°ç‰¹æ€§ç®¡ç†`
            },
            products: {
                title: 'ã‚¢ãƒ«ãƒŸãƒ‹ã‚¦ãƒ è£½å“ã‚¨ãƒªã‚¢',
                content: `<strong>æœ€çµ‚ç”¨é€”åˆ¥è£½å“ã®å¿œç”¨é ˜åŸŸ</strong><br>
                åŠ å·¥ã•ã‚ŒãŸã‚¢ãƒ«ãƒŸãƒ‹ã‚¦ãƒ ææ–™ãŒã€å„ç”£æ¥­åˆ†é‡ã®æœ€çµ‚è£½å“ã¨ã—ã¦å¿œç”¨ã•ã‚Œã‚‹é ˜åŸŸã§ã™ã€‚
                ä¸»è¦å¿œç”¨åˆ†é‡ï¼šå»ºç¯‰ï¼ˆçª“æ ãƒ»æ§‹é€ æï¼‰ã€è¼¸é€ï¼ˆè‡ªå‹•è»Šãƒ»èˆªç©ºæ©Ÿï¼‰ã€åŒ…è£…ï¼ˆç¼¶ãƒ»å®¹å™¨ï¼‰ã€é›»å­ï¼ˆæ”¾ç†±å™¨ãƒ»ç­ä½“ï¼‰ã€‚
                ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ï¼šä½¿ç”¨â†’å›åâ†’ãƒªã‚µã‚¤ã‚¯ãƒ«ã¸ã®å¾ªç’°`
            },
            // è©³ç´°ãƒ¬ãƒ™ãƒ«
            bauxite_mining: {
                title: 'ãƒœãƒ¼ã‚­ã‚µã‚¤ãƒˆæ¡æ˜',
                content: `<strong>ã‚¢ãƒ«ãƒŸãƒ‹ã‚¦ãƒ ã®åŸæ–™ã¨ãªã‚‹ãƒœãƒ¼ã‚­ã‚µã‚¤ãƒˆé‰±çŸ³ã®æ¡æ˜å·¥ç¨‹</strong><br>
                ä¸»ã«éœ²å¤©æ˜ã‚Šã§æ¡æ˜ã•ã‚Œã€å“è³ªç®¡ç†ã¨ç’°å¢ƒé…æ…®ãŒé‡è¦ã€‚æ¡æ˜å¾Œã®åœŸåœ°å¾©æ—§ã‚‚å«ã‚€æŒç¶šå¯èƒ½ãªæ¡æ˜ãŒæ±‚ã‚ã‚‰ã‚Œã¾ã™ã€‚`
            },
            alumina_refining: {
                title: 'ã‚¢ãƒ«ãƒŸãƒŠç²¾è£½',
                content: `<strong>ãƒœãƒ¼ã‚­ã‚µã‚¤ãƒˆã‹ã‚‰ã‚¢ãƒ«ãƒŸãƒŠï¼ˆé…¸åŒ–ã‚¢ãƒ«ãƒŸãƒ‹ã‚¦ãƒ ï¼‰ã‚’æŠ½å‡ºã™ã‚‹å·¥ç¨‹</strong><br>
                ãƒã‚¤ãƒ¤ãƒ¼æ³•ã‚’ä½¿ç”¨ã—ã€èµ¤æ³¥ã¨ã„ã†å‰¯ç”£ç‰©ã®é©åˆ‡ãªå‡¦ç†ãŒç’°å¢ƒä¸Šã®èª²é¡Œã¨ãªã£ã¦ã„ã¾ã™ã€‚`
            },
            electrolysis: {
                title: 'é›»è§£è£½éŒ¬',
                content: `<strong>ã‚¢ãƒ«ãƒŸãƒŠã‹ã‚‰é‡‘å±ã‚¢ãƒ«ãƒŸãƒ‹ã‚¦ãƒ ã‚’è£½éŒ¬ã™ã‚‹å·¥ç¨‹</strong><br>
                ãƒ›ãƒ¼ãƒ«ãƒ»ã‚¨ãƒ«ãƒ¼æ³•ã«ã‚ˆã‚Šã€å¤§é‡ã®é›»åŠ›ã‚’ä½¿ç”¨ã—ã¦ã‚¢ãƒ«ãƒŸãƒ‹ã‚¦ãƒ ã‚’ç”Ÿç”£ã—ã¾ã™ã€‚ã‚¨ãƒãƒ«ã‚®ãƒ¼åŠ¹ç‡ãŒé‡è¦ãªè¦ç´ ã§ã™ã€‚`
            },
            scrap_collection: {
                title: 'ã‚¹ã‚¯ãƒ©ãƒƒãƒ—å›åã‚·ã‚¹ãƒ†ãƒ ',
                content: `<strong>ä½¿ç”¨æ¸ˆã¿ã‚¢ãƒ«ãƒŸãƒ‹ã‚¦ãƒ è£½å“ã®åŠ¹ç‡çš„ãªå›åã‚·ã‚¹ãƒ†ãƒ </strong><br>
                å»ºç¯‰ã€è¼¸é€ã€åŒ…è£…ãªã©å„åˆ†é‡ã‹ã‚‰ã®å›åãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã¨åˆ†åˆ¥ã‚·ã‚¹ãƒ†ãƒ ãŒé‡è¦ã§ã™ã€‚`
            },
            preprocessing: {
                title: 'å‰å‡¦ç†å·¥ç¨‹',
                content: `<strong>ã‚¹ã‚¯ãƒ©ãƒƒãƒ—ã®æº¶è§£å‰æº–å‚™å·¥ç¨‹</strong><br>
                ç£æ°—åˆ†é›¢ã‚„æ¸¦é›»æµåˆ†é›¢ã«ã‚ˆã‚Šä»–ã®é‡‘å±ã‚’é™¤å»ã—ã€ç ´ç •ãƒ»æ´—æµ„ã‚’è¡Œã£ã¦æº¶è§£ã«é©ã—ãŸçŠ¶æ…‹ã«ã—ã¾ã™ã€‚`
            },
            melting_refining: {
                title: 'æº¶è§£ãƒ»ç²¾è£½ãƒ—ãƒ­ã‚»ã‚¹',
                content: `<strong>ã‚¹ã‚¯ãƒ©ãƒƒãƒ—ã‹ã‚‰é«˜å“è³ªã‚¢ãƒ«ãƒŸãƒ‹ã‚¦ãƒ ã¸ã®å¤‰æ›</strong><br>
                åå°„ç‚‰ã‚„å›è»¢ç‚‰ã«ã‚ˆã‚‹æº¶è§£ã€ãƒ•ãƒ©ãƒƒã‚¯ã‚¹å‡¦ç†ã«ã‚ˆã‚‹ã‚¬ã‚¹ãƒ»ä»‹åœ¨ç‰©é™¤å»ã«ã‚ˆã‚Šã€
                ä¸€æ¬¡ã‚¢ãƒ«ãƒŸãƒ‹ã‚¦ãƒ ã¨åŒç­‰å“è³ªã®å†ç”Ÿã‚¢ãƒ«ãƒŸãƒ‹ã‚¦ãƒ ã‚’è£½é€ ã—ã¾ã™ã€‚`
            },
            quality_control: {
                title: 'å“è³ªç®¡ç†ãƒ»åˆ†æ',
                content: `<strong>è£½å“å“è³ªä¿è¨¼ã®ãŸã‚ã®ç·åˆåˆ†æã‚·ã‚¹ãƒ†ãƒ </strong><br>
                åŒ–å­¦æˆåˆ†åˆ†æã€æ©Ÿæ¢°ç‰¹æ€§è©¦é¨“ã€çµ„ç¹”è¦³å¯Ÿã‚’é€šã˜ã¦å“è³ªã‚’ä¿è¨¼ã€‚
                ãƒˆãƒ¬ãƒ¼ã‚µãƒ“ãƒªãƒ†ã‚£ã‚·ã‚¹ãƒ†ãƒ ã«ã‚ˆã‚ŠåŸæ–™ã‹ã‚‰è£½å“ã¾ã§è¿½è·¡å¯èƒ½ã§ã™ã€‚`
            },
            secondary_ingot: {
                title: 'å†ç”Ÿã‚¤ãƒ³ã‚´ãƒƒãƒˆè£½é€ ',
                content: `<strong>ãƒªã‚µã‚¤ã‚¯ãƒ«ã‚¢ãƒ«ãƒŸãƒ‹ã‚¦ãƒ ã®æœ€çµ‚å½¢æ…‹</strong><br>
                ç²¾å¯†ãªé‹³é€ æŠ€è¡“ã¨å†·å´åˆ¶å¾¡ã«ã‚ˆã‚Šã€ç”¨é€”ã«å¿œã˜ãŸå“è³ªã®å†ç”Ÿã‚¤ãƒ³ã‚´ãƒƒãƒˆã‚’è£½é€ ã€‚
                ä¸€æ¬¡ã‚¤ãƒ³ã‚´ãƒƒãƒˆã¨åŒç­‰ã®å“è³ªã‚’å®Ÿç¾ã—ã¦ã„ã¾ã™ã€‚`
            }
        };
        
        // é¡ä¼¼åº¦æ¤œç´¢ãƒ¢ãƒ¼ãƒ‰ã®çŠ¶æ…‹
        let similaritySearchMode = false;
        let targetProcess = null;
        
        // åˆæœŸè¡¨ç¤º
        document.addEventListener('DOMContentLoaded', function() {
            renderCurrentLevel();
        });
        
        // ç¾åœ¨ã®ãƒ¬ãƒ™ãƒ«ã‚’æç”»
        function renderCurrentLevel() {
            const levelData = areaHierarchy[currentLevel];
            const container = document.getElementById('areasContainer');
            const mainTitle = document.getElementById('mainTitle');
            const backButton = document.getElementById('backButton');
            
            // ã‚¿ã‚¤ãƒˆãƒ«æ›´æ–°
            mainTitle.textContent = levelData.title;
            
            // æˆ»ã‚‹ãƒœã‚¿ãƒ³ã®è¡¨ç¤º/éè¡¨ç¤º
            if (currentLevel !== 'main') {
                backButton.style.display = 'block';
            } else {
                backButton.style.display = 'none';
            }
            
            // ã‚³ãƒ³ãƒ†ãƒŠã‚’ã‚¯ãƒªã‚¢
            container.innerHTML = '';
            
            // ã‚¨ãƒªã‚¢ã‚’ç”Ÿæˆ
            Object.keys(levelData.areas).forEach(areaKey => {
                const areaData = levelData.areas[areaKey];
                const areaElement = createAreaElement(areaKey, areaData);
                container.appendChild(areaElement);
            });
            
            // å‡¡ä¾‹ã‚’æ›´æ–°
            updateLegend(levelData.areas);
            
            // ãƒ‘ãƒ³ããšã‚’æ›´æ–°
            updateBreadcrumb();
        }
        
        // ã‚¨ãƒªã‚¢è¦ç´ ã‚’ä½œæˆ
        function createAreaElement(areaKey, areaData) {
            const area = document.createElement('div');
            area.className = `area ${areaData.has_detail ? 'clickable' : ''}`;
            area.style.background = areaData.color;
            area.setAttribute('data-key', areaKey);
            
            // ä½ç½®è¨­å®š
            const pos = areaData.position;
            
            // ãƒ¢ãƒã‚¤ãƒ«å‘ã‘ã«èª¿æ•´ã•ã‚ŒãŸä½ç½®æƒ…å ±ã‚’é©ç”¨
            if (window.innerWidth <= 768) {
                // ãƒ¢ãƒã‚¤ãƒ«ã§ã¯ç¸¦ã«é…ç½®
                const mobilePositions = {
                    // ãƒ¡ã‚¤ãƒ³ãƒ¬ãƒ™ãƒ«
                    'primary_production': { top: '170px', left: '10px', right: 'auto', width: 'calc(100% - 20px)', height: '220px' },
                    'secondary_production': { top: '410px', left: '10px', right: 'auto', width: 'calc(100% - 20px)', height: '220px' },
                    'alloys': { top: '650px', left: '10px', right: 'auto', width: 'calc(100% - 20px)', height: '220px' },
                    'processing': { top: '890px', left: '10px', right: 'auto', width: 'calc(100% - 20px)', height: '240px' },
                    'products': { top: '1150px', left: '10px', right: 'auto', width: 'calc(100% - 20px)', height: '240px' },
                    
                    // ä¸€æ¬¡ç”Ÿç”£ã‚¨ãƒªã‚¢è©³ç´°
                    'bauxite_mining': { top: '200px', left: '10px', right: 'auto', width: 'calc(100% - 20px)', height: '220px' },
                    'alumina_refining': { top: '440px', left: '10px', right: 'auto', width: 'calc(100% - 20px)', height: '220px' },
                    'electrolysis': { top: '680px', left: '10px', right: 'auto', width: 'calc(100% - 20px)', height: '250px' },
                    
                    // äºŒæ¬¡ç”Ÿç”£ã‚¨ãƒªã‚¢è©³ç´°
                    'scrap_collection': { top: '170px', left: '10px', right: 'auto', width: 'calc(100% - 20px)', height: '200px' },
                    'preprocessing': { top: '390px', left: '10px', right: 'auto', width: 'calc(100% - 20px)', height: '200px' },
                    'melting_refining': { top: '610px', left: '10px', right: 'auto', width: 'calc(100% - 20px)', height: '220px' },
                    'quality_control': { top: '850px', left: '10px', right: 'auto', width: 'calc(100% - 20px)', height: '180px' },
                    'secondary_ingot': { top: '1050px', left: '10px', right: 'auto', width: 'calc(100% - 20px)', height: '180px' }
                };
                
                const areaKey = Object.keys(areaHierarchy[currentLevel].areas).find(key => 
                    areaHierarchy[currentLevel].areas[key] === areaData
                );
                
                if (mobilePositions[areaKey]) {
                    Object.keys(mobilePositions[areaKey]).forEach(prop => {
                        area.style[prop] = mobilePositions[areaKey][prop];
                    });
                } else {
                    // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ä½ç½®è¨­å®š
                    Object.keys(pos).forEach(prop => {
                        if (prop === 'left' && pos[prop].toString().includes('%')) {
                            area.style.left = pos[prop];
                        } else if (prop === 'right') {
                            area.style.right = pos[prop] + 'px';
                        } else if (prop === 'transform') {
                            area.style.transform = pos[prop];
                        } else if (typeof pos[prop] === 'number') {
                            area.style[prop] = pos[prop] + 'px';
                        } else {
                            area.style[prop] = pos[prop];
                        }
                    });
                }
            } else {
                // ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã®ä½ç½®è¨­å®š
                Object.keys(pos).forEach(prop => {
                    if (prop === 'left' && pos[prop].toString().includes('%')) {
                        area.style.left = pos[prop];
                    } else if (prop === 'right') {
                        area.style.right = pos[prop] + 'px';
                    } else if (prop === 'transform') {
                        area.style.transform = pos[prop];
                    } else if (typeof pos[prop] === 'number') {
                        area.style[prop] = pos[prop] + 'px';
                    } else {
                        area.style[prop] = pos[prop];
                    }
                });
            }
            
            // ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
            if (areaData.has_detail) {
                area.addEventListener('click', () => navigateToDetail(areaKey));
            } else {
                area.addEventListener('click', () => showAreaInfo(areaKey));
            }
            
            // ãƒ›ãƒãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¿½åŠ 
            area.addEventListener('mouseenter', () => {
                showAreaInfo(areaKey);
                area.classList.add('info-hover');
            });
            area.addEventListener('mouseleave', () => {
                showDefaultInfo();
                area.classList.remove('info-hover');
            });
            
            // ã‚¿ã‚¤ãƒˆãƒ«
            const title = document.createElement('div');
            title.className = 'area-title';
            title.textContent = areaData.name;
            area.appendChild(title);
            
            // é¡ä¼¼åº¦æ¤œç´¢ãƒœã‚¿ãƒ³ã‚’è¿½åŠ ï¼ˆãƒœãƒ¼ã‚­ã‚µã‚¤ãƒˆæ¡æ˜ã‚¨ãƒªã‚¢ã®å ´åˆï¼‰
            if (areaKey === 'bauxite_mining' && currentLevel === 'primary_production') {
                const searchBtn = document.createElement('button');
                searchBtn.className = 'similarity-search-btn';
                searchBtn.textContent = 'ğŸ” é¡ä¼¼ãƒ—ãƒ­ã‚»ã‚¹æ¤œç´¢';
                searchBtn.onclick = (e) => {
                    e.stopPropagation();
                    openSimilarityModal('bauxite_mining');
                };
                area.appendChild(searchBtn);
            }
            
            // ã‚³ãƒ³ãƒ†ãƒ³ãƒ„
            const content = document.createElement('div');
            content.className = 'area-content';
            
            areaData.sub_items.forEach(item => {
                const subItem = document.createElement('div');
                subItem.className = 'sub-item';
                
                // éœ²å¤©æ˜ã‚Šæ¡æ˜ã®å ´åˆã¯ã‚¯ãƒªãƒƒã‚¯å¯èƒ½ã«ã™ã‚‹
                if (item === 'éœ²å¤©æ˜ã‚Šæ¡æ˜') {
                    subItem.classList.add('clickable-sub-item');
                    subItem.style.position = 'relative';
                    subItem.addEventListener('click', (e) => {
                        e.stopPropagation(); // è¦ªè¦ç´ ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’é˜²ã
                        showActivityModal(item);
                    });
                }
                
                subItem.textContent = item;
                content.appendChild(subItem);
            });
            
            area.appendChild(content);
            
            return area;
        }
        
        // è©³ç´°ç”»é¢ã«é·ç§»
        function navigateToDetail(areaKey) {
            if (areaHierarchy[areaKey]) {
                currentLevel = areaKey;
                breadcrumb.push(areaHierarchy[areaKey].title);
                
                // ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆ â†’ ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¤ãƒ³
                const mainArea = document.getElementById('mainArea');
                mainArea.classList.remove('active');
                
                setTimeout(() => {
                    renderCurrentLevel();
                    mainArea.classList.add('active');
                }, 300);
            }
        }
        
        // æˆ»ã‚‹
        function goBack() {
            if (currentLevel !== 'main') {
                const parentLevel = areaHierarchy[currentLevel].parent || 'main';
                currentLevel = parentLevel;
                breadcrumb.pop();
                
                // ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆ â†’ ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¤ãƒ³
                const mainArea = document.getElementById('mainArea');
                mainArea.classList.remove('active');
                
                setTimeout(() => {
                    renderCurrentLevel();
                    mainArea.classList.add('active');
                }, 300);
            }
        }
        
        // ã‚¨ãƒªã‚¢æƒ…å ±è¡¨ç¤º
        function showAreaInfo(areaKey) {
            const infoContent = document.getElementById('infoContentTop');
            const infoTitle = document.querySelector('#infoPanelTop .info-title');
            
            // ãƒ¡ã‚¤ãƒ³ãƒ¬ãƒ™ãƒ«ã§ã¯å¯¾å¿œã™ã‚‹ã‚­ãƒ¼ã‚’å¤‰æ›
            let infoKey = areaKey;
            if (currentLevel === 'main') {
                const keyMapping = {
                    'primary_production': 'primary',
                    'secondary_production': 'secondary',
                    'alloys': 'alloys',
                    'processing': 'processing',
                    'products': 'products'
                };
                infoKey = keyMapping[areaKey] || areaKey;
            }
            
            if (areaInfo[infoKey]) {
                infoTitle.textContent = areaInfo[infoKey].title;
                infoContent.innerHTML = areaInfo[infoKey].content;
            } else {
                infoTitle.textContent = 'ã‚¨ãƒªã‚¢æƒ…å ±';
                infoContent.innerHTML = 'ã“ã®ã‚¨ãƒªã‚¢ã®è©³ç´°æƒ…å ±ã¯æº–å‚™ä¸­ã§ã™ã€‚';
            }
        }
        
        // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæƒ…å ±è¡¨ç¤º
        function showDefaultInfo() {
            const infoContent = document.getElementById('infoContentTop');
            const infoTitle = document.querySelector('#infoPanelTop .info-title');
            
            infoTitle.textContent = 'ã‚¨ãƒªã‚¢æƒ…å ±';
            if (currentLevel === 'main') {
                infoContent.innerHTML = `å„ã‚¨ãƒªã‚¢ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦è©³ç´°æƒ…å ±ã‚’è¡¨ç¤ºã™ã‚‹ã‹ã€è©³ç´°ã‚¨ãƒªã‚¢ã«ç§»å‹•ã—ã¦ãã ã•ã„ã€‚<br>
                ã“ã®å›³ã¯ã€ecoinventãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ãŠã‘ã‚‹ã‚¢ãƒ«ãƒŸãƒ‹ã‚¦ãƒ é–¢é€£ãƒ—ãƒ­ã‚»ã‚¹ã‚’åœ°ç†çš„ã‚¨ãƒªã‚¢ã®ã‚ˆã†ã«è¡¨ç¾ã—ã€
                ãã‚Œãã‚Œã®é ˜åŸŸå†…ã«é–¢é€£ã™ã‚‹ãƒ—ãƒ­ã‚»ã‚¹ã‚„ã‚«ãƒ†ã‚´ãƒªã‚’ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã—ã¦ã„ã¾ã™ã€‚`;
            } else {
                infoContent.innerHTML = `å„ã‚¨ãƒªã‚¢ã‚’ã‚¯ãƒªãƒƒã‚¯ã¾ãŸã¯ãƒ›ãƒãƒ¼ã—ã¦è©³ç´°æƒ…å ±ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚<br>
                ã“ã®ãƒ¬ãƒ™ãƒ«ã§ã¯ã€ã‚ˆã‚Šå…·ä½“çš„ãªãƒ—ãƒ­ã‚»ã‚¹ã‚„ã‚«ãƒ†ã‚´ãƒªã®è©³ç´°ã‚’è¡¨ç¤ºã—ã¦ã„ã¾ã™ã€‚`;
            }
        }
        
        // å‡¡ä¾‹æ›´æ–°
        function updateLegend(areas) {
            const legendContent = document.getElementById('legendContent');
            legendContent.innerHTML = '';
            
            Object.values(areas).forEach(areaData => {
                const legendItem = document.createElement('div');
                legendItem.className = 'legend-item';
                
                const colorBox = document.createElement('div');
                colorBox.className = 'legend-color';
                colorBox.style.background = areaData.legend_color;
                
                const text = document.createElement('span');
                text.className = 'legend-text';
                text.textContent = areaData.name.replace('ã‚¨ãƒªã‚¢', '');
                
                legendItem.appendChild(colorBox);
                legendItem.appendChild(text);
                legendContent.appendChild(legendItem);
            });
        }
        
        // ãƒ‘ãƒ³ããšæ›´æ–°
        function updateBreadcrumb() {
            const breadcrumbContainer = document.getElementById('breadcrumb');
            breadcrumbContainer.innerHTML = '';
            
            breadcrumb.forEach((item, index) => {
                const breadcrumbItem = document.createElement('span');
                breadcrumbItem.className = 'breadcrumb-item';
                breadcrumbItem.textContent = item;
                
                if (index < breadcrumb.length - 1) {
                    breadcrumbItem.classList.add('clickable');
                    breadcrumbItem.addEventListener('click', () => {
                        // ãƒ‘ãƒ³ããšã‚¯ãƒªãƒƒã‚¯ã§è©²å½“ãƒ¬ãƒ™ãƒ«ã«æˆ»ã‚‹
                        if (index === 0) {
                            currentLevel = 'main';
                            breadcrumb = ['ã‚¢ãƒ«ãƒŸãƒ‹ã‚¦ãƒ å…¨ä½“'];
                        }
                        renderCurrentLevel();
                    });
                }
                
                breadcrumbContainer.appendChild(breadcrumbItem);
            });
        }
        
        // åˆæœŸã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
        function initializeAnimation() {
            const areas = document.querySelectorAll('.area');
            areas.forEach((area, index) => {
                area.style.opacity = '0';
                area.style.transform += ' scale(0.8)';
                setTimeout(() => {
                    area.style.transition = 'all 0.6s ease';
                    area.style.opacity = '1';
                    area.style.transform = area.style.transform.replace('scale(0.8)', 'scale(1)');
                }, index * 200 + 500);
            });
        }
        
        // ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°å¾Œã«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
        setTimeout(initializeAnimation, 100);
        
        // Activity Modal é–¢é€£é–¢æ•°
        function showActivityModal(itemName) {
            const modal = document.getElementById('activityModal');
            const modalTitle = document.getElementById('modalTitle');
            const activityList = document.getElementById('activityList');
            
            if (activityData[itemName]) {
                const data = activityData[itemName];
                modalTitle.textContent = data.title;
                
                // Activityä¸€è¦§ã‚’ç”Ÿæˆ
                activityList.innerHTML = '';
                data.activities.forEach(activity => {
                    const activityElement = document.createElement('div');
                    activityElement.className = 'activity-item';
                    
                    activityElement.innerHTML = `
                        <div class="activity-id">${activity.id}</div>
                        <div class="activity-name">${activity.name}</div>
                        <div class="activity-description">${activity.description}</div>
                    `;
                    
                    activityList.appendChild(activityElement);
                });
                
                modal.style.display = 'block';
                document.body.style.overflow = 'hidden'; // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ç„¡åŠ¹åŒ–
            }
        }
        
        function closeActivityModal() {
            const modal = document.getElementById('activityModal');
            modal.style.display = 'none';
            document.body.style.overflow = 'auto'; // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«æœ‰åŠ¹åŒ–
        }
        
        // ãƒ¢ãƒ¼ãƒ€ãƒ«å¤–ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
        document.getElementById('activityModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeActivityModal();
            }
        });
        
        // ESCã‚­ãƒ¼ã§é–‰ã˜ã‚‹
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeActivityModal();
                closeSimilarityModal();
            }
        });
        
        // é¡ä¼¼åº¦æ¤œç´¢ãƒ¢ãƒ¼ãƒ€ãƒ«é–¢æ•°
        function openSimilarityModal(areaKey) {
            const modal = document.getElementById('similarityModal');
            const title = document.getElementById('similarityModalTitle');
            title.textContent = 'ãƒœãƒ¼ã‚­ã‚µã‚¤ãƒˆæ¡æ˜ - é¡ä¼¼ãƒ—ãƒ­ã‚»ã‚¹æ¤œç´¢';
            modal.style.display = 'block';
            document.body.style.overflow = 'hidden';
        }
        
        function closeSimilarityModal() {
            const modal = document.getElementById('similarityModal');
            modal.style.display = 'none';
            document.body.style.overflow = 'auto';
            // é¡ä¼¼åº¦ãƒãƒƒã‚¸ã‚’ã‚¯ãƒªã‚¢
            document.querySelectorAll('.similarity-badge').forEach(badge => badge.remove());
        }
        
        function searchSimilarProcesses() {
            const methodName = document.getElementById('miningMethodName').value;
            const depth = document.getElementById('miningDepth').value;
            const scale = document.getElementById('miningScale').value;
            
            if (!methodName) {
                alert('æ¡æ˜æ–¹æ³•åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            // ä»®ã®ç‰¹æ€§å€¤ã‚’è¨­å®šï¼ˆå®Ÿéš›ã«ã¯å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰å–å¾—ï¼‰
            const targetCharacteristics = {
                æ·±åº¦: depth,
                ç’°å¢ƒå½±éŸ¿: depth === 'underwater' ? 90 : 60,
                ã‚³ã‚¹ãƒˆ: scale === 'large' ? 80 : 50,
                ç”Ÿç”£åŠ¹ç‡: scale === 'large' ? 85 : 60,
                å®‰å…¨æ€§: depth === 'underwater' ? 40 : 70,
                ã‚¨ãƒãƒ«ã‚®ãƒ¼æ¶ˆè²»: depth === 'deep' ? 90 : 65
            };
            
            // é¡ä¼¼åº¦è¨ˆç®—
            const results = [];
            Object.keys(processSimilarityData['æ¡æ˜æ–¹æ³•']).forEach(processName => {
                const similarity = calculateSimilarity(
                    targetCharacteristics,
                    processSimilarityData['æ¡æ˜æ–¹æ³•'][processName]
                );
                results.push({
                    name: processName,
                    similarity: similarity,
                    data: processSimilarityData['æ¡æ˜æ–¹æ³•'][processName]
                });
            });
            
            // ä»–ã®ã‚«ãƒ†ã‚´ãƒªã‹ã‚‰ã‚‚é¡ä¼¼ãƒ—ãƒ­ã‚»ã‚¹ã‚’æ¢ã™ï¼ˆä¾‹ï¼‰
            results.push({
                name: 'æ©Ÿæ¢°åŠ å·¥ (åˆ‡å‰Šãƒ»ç ”ç£¨)',
                category: 'ã‚¢ãƒ«ãƒŸãƒ‹ã‚¦ãƒ åŠ å·¥ã‚¨ãƒªã‚¢',
                similarity: {
                    total: 35,
                    details: {
                        æ·±åº¦: 0,
                        ç’°å¢ƒå½±éŸ¿: 40,
                        ã‚³ã‚¹ãƒˆ: 60,
                        ç”Ÿç”£åŠ¹ç‡: 50,
                        å®‰å…¨æ€§: 80,
                        ã‚¨ãƒãƒ«ã‚®ãƒ¼æ¶ˆè²»: 45
                    }
                },
                note: 'ææ–™é™¤å»ãƒ—ãƒ­ã‚»ã‚¹ã¨ã—ã¦ã®é¡ä¼¼æ€§'
            });
            
            // ã‚¹ã‚³ã‚¢é †ã«ã‚½ãƒ¼ãƒˆ
            results.sort((a, b) => b.similarity.total - a.similarity.total);
            
            // çµæœè¡¨ç¤º
            displaySimilarityResults(methodName, results);
        }
        
        function displaySimilarityResults(targetMethod, results) {
            const resultsContainer = document.getElementById('similarityResults');
            resultsContainer.innerHTML = `
                <h3>ã€Œ${targetMethod}ã€ã«é¡ä¼¼ã™ã‚‹ãƒ—ãƒ­ã‚»ã‚¹</h3>
            `;
            
            results.forEach((result, index) => {
                const scoreClass = result.similarity.total >= 70 ? 'similarity-high' : 
                                  result.similarity.total >= 50 ? 'similarity-medium' : 'similarity-low';
                
                const resultItem = document.createElement('div');
                resultItem.className = 'similarity-result-item';
                resultItem.innerHTML = `
                    <h4>${result.name} ${result.category ? `ï¼ˆ${result.category}ï¼‰` : ''}</h4>
                    <div class="similarity-score ${scoreClass}">${result.similarity.total}%</div>
                    ${result.note ? `<p style="color: #666; font-size: 14px; margin: 10px 0;">${result.note}</p>` : ''}
                    
                    <div class="similarity-details">
                        <h5>è©³ç´°ãªé¡ä¼¼åº¦åˆ†æ:</h5>
                        ${Object.keys(result.similarity.details).map(key => `
                            <div class="similarity-chart">
                                <div class="similarity-chart-label">${key}:</div>
                                <div class="similarity-chart-bar">
                                    <div class="similarity-chart-fill" style="width: ${result.similarity.details[key]}%"></div>
                                </div>
                                <div class="similarity-chart-value">${result.similarity.details[key]}%</div>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div style="margin-top: 15px; padding: 10px; background: #f0f8ff; border-radius: 5px; font-size: 13px;">
                        <strong>æ¨å¥¨äº‹é …:</strong> 
                        ${result.similarity.total >= 70 ? 
                            'ã“ã®ãƒ—ãƒ­ã‚»ã‚¹ã®ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‚’ä½¿ç”¨ã—ã€æ·±åº¦ã‚„è¦æ¨¡ã®å·®ç•°ã‚’è£œæ­£ä¿‚æ•°ã§èª¿æ•´ã™ã‚‹ã“ã¨ã‚’æ¨å¥¨ã—ã¾ã™ã€‚' :
                            result.similarity.total >= 50 ?
                            'ã“ã®ãƒ—ãƒ­ã‚»ã‚¹ã‚’å‚è€ƒã«ã—ã¤ã¤ã€ä¸»è¦ãªå·®ç•°ç‚¹ã«ã¤ã„ã¦è¿½åŠ ã®èª¿æŸ»ã‚„å°‚é–€å®¶ã¸ã®ç›¸è«‡ã‚’æ¨å¥¨ã—ã¾ã™ã€‚' :
                            'é¡ä¼¼åº¦ãŒä½ã„ãŸã‚ã€è¤‡æ•°ã®ãƒ—ãƒ­ã‚»ã‚¹ã‚’çµ„ã¿åˆã‚ã›ã‚‹ã‹ã€æ–°è¦ãƒ‡ãƒ¼ã‚¿ã®åé›†ã‚’æ¤œè¨ã—ã¦ãã ã•ã„ã€‚'
                        }
                    </div>
                `;
                
                resultsContainer.appendChild(resultItem);
                
                // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
                setTimeout(() => {
                    resultItem.style.opacity = '0';
                    resultItem.style.transform = 'translateY(20px)';
                    requestAnimationFrame(() => {
                        resultItem.style.transition = 'all 0.5s ease';
                        resultItem.style.opacity = '1';
                        resultItem.style.transform = 'translateY(0)';
                    });
                }, index * 100);
            });
            
            // å…ƒã®ã‚¨ãƒªã‚¢ã«é¡ä¼¼åº¦ãƒãƒƒã‚¸ã‚’è¡¨ç¤º
            closeSimilarityModal();
            showSimilarityBadges(results);
        }
        
        function showSimilarityBadges(results) {
            // ç¾åœ¨è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã‚¨ãƒªã‚¢ã«é¡ä¼¼åº¦ãƒãƒƒã‚¸ã‚’è¿½åŠ 
            results.slice(0, 2).forEach(result => {
                const areas = document.querySelectorAll('.area');
                areas.forEach(area => {
                    const title = area.querySelector('.area-title');
                    if (title && title.textContent.includes(result.name)) {
                        const badge = document.createElement('div');
                        badge.className = 'similarity-badge';
                        const scoreClass = result.similarity.total >= 70 ? 'similarity-high' : 
                                          result.similarity.total >= 50 ? 'similarity-medium' : 'similarity-low';
                        badge.classList.add(scoreClass);
                        badge.textContent = `${result.similarity.total}% ä¸€è‡´`;
                        area.appendChild(badge);
                    }
                });
            });
        }
        
        // æŠ½è±¡æ¤œç´¢æ©Ÿèƒ½
        const abstractSearchInput = document.getElementById('abstractSearchInput');
        const searchSuggestions = document.getElementById('searchSuggestions');
        
        // æ¤œç´¢å€™è£œã‚’è¡¨ç¤º
        abstractSearchInput.addEventListener('input', function(e) {
            const query = e.target.value.toLowerCase();
            if (query.length < 2) {
                searchSuggestions.style.display = 'none';
                return;
            }
            
            const matches = Object.keys(presetMixes).filter(key => 
                key.toLowerCase().includes(query)
            );
            
            if (matches.length > 0) {
                searchSuggestions.innerHTML = '';
                matches.forEach(match => {
                    const item = document.createElement('div');
                    item.className = 'suggestion-item';
                    item.textContent = match;
                    item.onclick = () => {
                        abstractSearchInput.value = match;
                        searchSuggestions.style.display = 'none';
                        performAbstractSearch();
                    };
                    searchSuggestions.appendChild(item);
                });
                searchSuggestions.style.display = 'block';
            } else {
                searchSuggestions.style.display = 'none';
            }
        });
        
        // æŠ½è±¡æ¤œç´¢å®Ÿè¡Œ
        function performAbstractSearch() {
            const query = abstractSearchInput.value;
            if (presetMixes[query]) {
                showMixComposition(query);
            } else {
                alert('è©²å½“ã™ã‚‹ãƒ—ãƒªã‚»ãƒƒãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚é¡ä¼¼ã®æ¤œç´¢èªã‚’ãŠè©¦ã—ãã ã•ã„ã€‚');
            }
        }
        
        // ãƒŸãƒƒã‚¯ã‚¹æ§‹æˆè¡¨ç¤º
        function showMixComposition(mixName) {
            const mixData = presetMixes[mixName];
            
            // ãƒ¢ãƒ¼ãƒ€ãƒ«ä½œæˆ
            const modalOverlay = document.createElement('div');
            modalOverlay.className = 'modal-overlay';
            modalOverlay.style.display = 'block';
            modalOverlay.id = 'mixCompositionModal';
            
            const modal = document.createElement('div');
            modal.className = 'mix-composition-modal';
            
            modal.innerHTML = `
                <div class="modal-header">
                    <button class="modal-close" onclick="closeMixModal()">&times;</button>
                </div>
                
                <div class="mix-header">
                    <h2 class="mix-title">${mixData.name}</h2>
                    <p class="mix-subtitle">${mixData.description}</p>
                </div>
                
                <div class="preset-info">
                    <h4>ãƒ‡ãƒ¼ã‚¿æƒ…å ±</h4>
                    <p><strong>å¹´åº¦:</strong> ${mixData.year}å¹´</p>
                    <p><strong>å‡ºå…¸:</strong> ${mixData.source}</p>
                    <p><strong>æ§‹æˆè¦ç´ æ•°:</strong> ${mixData.components.length}é …ç›®</p>
                </div>
                
                <div class="mix-content">
                    <div class="mix-visualization">
                        <h3>æ§‹æˆæ¯”ç‡</h3>
                        <div class="mix-chart" id="mixChart">
                            <canvas id="pieChart" width="300" height="300"></canvas>
                        </div>
                    </div>
                    
                    <div class="mix-components">
                        <h3>æ§‹æˆè¦ç´ </h3>
                        <div id="componentsList">
                            ${mixData.components.map((comp, index) => `
                                <div class="component-item">
                                    <div class="component-info">
                                        <div class="component-name">${comp.name}</div>
                                        <div class="component-id">ID: ${comp.id}</div>
                                        <div style="font-size: 12px; color: #666; margin-top: 2px;">ã‚«ãƒ†ã‚´ãƒª: ${comp.category}</div>
                                    </div>
                                    <div class="component-actions">
                                        <span class="component-percentage">${comp.percentage}%</span>
                                        <input type="number" class="percentage-input" value="${comp.percentage}" 
                                               id="input-${index}" min="0" max="100" step="0.1"
                                               onchange="updatePercentage(${index})">
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        <div style="margin-top: 15px; padding: 10px; background: #f8f9fa; border-radius: 5px; text-align: center;">
                            <strong>åˆè¨ˆ: <span id="totalPercentage">100</span>%</strong>
                        </div>
                    </div>
                </div>
                
                <div class="mix-actions">
                    <button class="mix-action-btn btn-primary" onclick="applyMixComposition('${mixName}')">
                        ã“ã®æ§‹æˆã‚’é©ç”¨
                    </button>
                    <button class="mix-action-btn btn-secondary" onclick="exportMixComposition('${mixName}')">
                        æ§‹æˆã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
                    </button>
                    <button class="mix-action-btn btn-secondary" onclick="closeMixModal()">
                        ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                    </button>
                </div>
            `;
            
            modalOverlay.appendChild(modal);
            document.body.appendChild(modalOverlay);
            document.body.style.overflow = 'hidden';
            
            // å††ã‚°ãƒ©ãƒ•æç”»
            drawPieChart(mixData.components);
            
            // ç¾åœ¨ã®æ§‹æˆãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
            window.currentMixData = JSON.parse(JSON.stringify(mixData));
        }
        
        function drawPieChart(components) {
            const canvas = document.getElementById('pieChart');
            const ctx = canvas.getContext('2d');
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const radius = 120;
            
            // è‰²ãƒ‘ãƒ¬ãƒƒãƒˆ
            const colors = [
                '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF',
                '#FF9F40', '#FF6384', '#C9CBCF', '#4BC0C0', '#36A2EB'
            ];
            
            let currentAngle = -Math.PI / 2; // ä¸Šã‹ã‚‰é–‹å§‹
            
            components.forEach((comp, index) => {
                const sliceAngle = (comp.percentage / 100) * 2 * Math.PI;
                
                // æ‰‡å½¢æç”»
                ctx.beginPath();
                ctx.arc(centerX, centerY, radius, currentAngle, currentAngle + sliceAngle);
                ctx.lineTo(centerX, centerY);
                ctx.fillStyle = colors[index % colors.length];
                ctx.fill();
                
                // ãƒ©ãƒ™ãƒ«æç”»ï¼ˆ5%ä»¥ä¸Šã®å ´åˆï¼‰
                if (comp.percentage >= 5) {
                    const labelAngle = currentAngle + sliceAngle / 2;
                    const labelX = centerX + Math.cos(labelAngle) * (radius * 0.7);
                    const labelY = centerY + Math.sin(labelAngle) * (radius * 0.7);
                    
                    ctx.fillStyle = 'white';
                    ctx.font = 'bold 14px Arial';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillText(comp.percentage + '%', labelX, labelY);
                }
                
                currentAngle += sliceAngle;
            });
        }
        
        function updatePercentage(index) {
            const input = document.getElementById(`input-${index}`);
            const newValue = parseFloat(input.value) || 0;
            window.currentMixData.components[index].percentage = newValue;
            
            // åˆè¨ˆã‚’æ›´æ–°
            const total = window.currentMixData.components.reduce((sum, comp) => sum + comp.percentage, 0);
            document.getElementById('totalPercentage').textContent = total.toFixed(1);
            
            // ã‚°ãƒ©ãƒ•ã‚’å†æç”»
            const canvas = document.getElementById('pieChart');
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawPieChart(window.currentMixData.components);
        }
        
        function closeMixModal() {
            const modal = document.getElementById('mixCompositionModal');
            if (modal) {
                modal.remove();
                document.body.style.overflow = 'auto';
            }
        }
        
        function applyMixComposition(mixName) {
            const total = window.currentMixData.components.reduce((sum, comp) => sum + comp.percentage, 0);
            if (Math.abs(total - 100) > 0.1) {
                alert('æ§‹æˆæ¯”ã®åˆè¨ˆã¯100%ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ç¾åœ¨ã®åˆè¨ˆ: ' + total.toFixed(1) + '%');
                return;
            }
            
            alert(`ã€Œ${mixName}ã€ã®æ§‹æˆãŒé©ç”¨ã•ã‚Œã¾ã—ãŸã€‚\n\n` +
                  'é©ç”¨ã•ã‚ŒãŸæ§‹æˆ:\n' +
                  window.currentMixData.components.map(comp => 
                      `${comp.name}: ${comp.percentage}%`
                  ).join('\n'));
            
            closeMixModal();
        }
        
        function exportMixComposition(mixName) {
            const exportData = {
                name: window.currentMixData.name,
                timestamp: new Date().toISOString(),
                components: window.currentMixData.components
            };
            
            const blob = new Blob([JSON.stringify(exportData, null, 2)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${mixName.replace(/\s+/g, '_')}_composition.json`;
            a.click();
            URL.revokeObjectURL(url);
        }
        
        // ã‚¯ãƒªãƒƒã‚¯å¤–ã§ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã‚’é–‰ã˜ã‚‹
        document.addEventListener('click', function(e) {
            if (!abstractSearchInput.contains(e.target) && !searchSuggestions.contains(e.target)) {
                searchSuggestions.style.display = 'none';
            }
        });
    </script>
</body>
</html>
