<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ecoinvent „Ç¢„É´„Éü„Éã„Ç¶„É†„Ç´„ÉÜ„Ç¥„É™ÈöéÂ±§Âõ≥</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        @media (max-width: 1200px) {
            .container {
                max-width: 95%;
                padding: 20px;
            }
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 15px;
                border-radius: 10px;
            }
        }
        
        .title {
            text-align: center;
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 20px;
            color: #333;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        
        .breadcrumb {
            text-align: center;
            margin-bottom: 20px;
            padding: 10px;
            background: rgba(52, 73, 94, 0.1);
            border-radius: 10px;
        }
        
        .breadcrumb-item {
            display: inline;
            color: #2c3e50;
            font-weight: 500;
        }
        
        .breadcrumb-item:not(:last-child)::after {
            content: " > ";
            color: #7f8c8d;
            margin: 0 8px;
        }
        
        .breadcrumb-item.clickable {
            cursor: pointer;
            color: #3498db;
            text-decoration: underline;
        }
        
        .breadcrumb-item.clickable:hover {
            color: #2980b9;
        }
        
        .main-area {
            position: relative;
            width: 100%;
            height: 1200px;
            background: linear-gradient(45deg, #f8f9fa, #e9ecef);
            border: 3px solid #333;
            border-radius: 20px;
            margin: 0 auto;
            overflow: hidden;
            transition: all 0.5s ease;
        }
        
        @media (max-width: 1200px) {
            .main-area {
                height: 1000px;
            }
        }
        
        @media (max-width: 768px) {
            .main-area {
                height: 1400px;
                border: 2px solid #333;
            }
        }
        
        .main-title {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 24px;
            font-weight: bold;
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
            z-index: 100;
        }
        
        .info-panel-top {
            position: absolute;
            top: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.95);
            padding: 15px 25px;
            border-radius: 12px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
            max-width: 600px;
            min-width: 400px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.3);
            z-index: 100;
        }
        
        .area {
            position: absolute;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid rgba(255,255,255,0.3);
        }
        
        @media (max-width: 768px) {
            .area {
                padding: 15px;
                border-radius: 10px;
                min-width: 250px !important;
                min-height: 200px !important;
            }
        }
        
        .area:hover {
            transform: scale(1.05);
            box-shadow: 0 12px 35px rgba(0,0,0,0.25);
            z-index: 50;
            border: 3px solid rgba(255,255,255,0.8);
        }
        
        .area.info-hover {
            border: 2px solid rgba(52, 152, 219, 0.8);
            box-shadow: 0 0 20px rgba(52, 152, 219, 0.3);
        }
        
        .area.clickable::after {
            content: "üì± „ÇØ„É™„ÉÉ„ÇØ„ÅßË©≥Á¥∞";
            position: absolute;
            top: 5px;
            right: 10px;
            font-size: 12px;
            color: rgba(255,255,255,0.8);
            background: rgba(0,0,0,0.3);
            padding: 2px 8px;
            border-radius: 10px;
        }
        
        .area-title {
            font-size: 18px;
            font-weight: bold;
            color: white;
            margin-bottom: 15px;
            text-align: center;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            line-height: 1.2;
        }
        
        @media (max-width: 768px) {
            .area-title {
                font-size: 16px;
                margin-bottom: 12px;
            }
        }
        
        .area-content {
            background: rgba(255,255,255,0.9);
            border-radius: 10px;
            padding: 15px;
            height: calc(100% - 80px);
            overflow-y: auto;
        }
        
        .sub-item {
            background: linear-gradient(135deg, #fff, #f8f9fa);
            margin: 8px 0;
            padding: 12px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            color: #333;
            border-left: 4px solid #007bff;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: all 0.2s ease;
            line-height: 1.4;
        }
        
        @media (max-width: 768px) {
            .sub-item {
                font-size: 13px;
                padding: 10px;
                margin: 6px 0;
            }
        }
        
        .sub-item:hover {
            transform: translateX(5px);
            border-left-color: #ffc107;
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
        }
        
        .info-title {
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
            font-size: 16px;
            border-bottom: 2px solid #007bff;
            padding-bottom: 5px;
        }
        
        .info-text {
            font-size: 14px;
            line-height: 1.6;
            color: #555;
        }
        
        @media (max-width: 768px) {
            .info-text {
                font-size: 13px;
            }
        }
        
        .legend {
            position: fixed;
            bottom: 30px;
            left: 30px;
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.3);
            max-width: 250px;
        }
        
        @media (max-width: 768px) {
            .legend {
                bottom: 20px;
                left: 20px;
                padding: 15px;
                max-width: 200px;
                border-radius: 10px;
            }
        }
        
        .legend-title {
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
            border-bottom: 2px solid #007bff;
            padding-bottom: 5px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin: 8px 0;
        }
        
        .legend-color {
            width: 25px;
            height: 25px;
            margin-right: 12px;
            border-radius: 6px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }
        
        .legend-text {
            font-size: 13px;
            color: #333;
            font-weight: 500;
        }
        
        .back-button {
            position: fixed;
            top: 30px;
            left: 30px;
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 8px 20px rgba(231, 76, 60, 0.3);
            transition: all 0.3s ease;
            display: none;
            z-index: 200;
        }
        
        .back-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 30px rgba(231, 76, 60, 0.4);
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 8px 25px rgba(0,0,0,0.15); }
            50% { box-shadow: 0 12px 35px rgba(0,0,0,0.25); }
            100% { box-shadow: 0 8px 25px rgba(0,0,0,0.15); }
        }
        
        .area.active {
            animation: pulse 2s infinite;
        }
        
        .fade-transition {
            opacity: 0;
            transition: opacity 0.5s ease;
        }
        
        .fade-transition.active {
            opacity: 1;
        }
        
        .clickable-sub-item {
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .clickable-sub-item:hover {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb) !important;
            transform: translateX(8px);
            border-left-color: #2196f3 !important;
            box-shadow: 0 4px 12px rgba(33, 150, 243, 0.3);
        }
        
        .clickable-sub-item::after {
            content: "üìã „ÇØ„É™„ÉÉ„ÇØ„ÅßË©≥Á¥∞";
            position: absolute;
            top: 2px;
            right: 8px;
            font-size: 10px;
            color: rgba(0,0,0,0.5);
            background: rgba(255,255,255,0.8);
            padding: 1px 6px;
            border-radius: 8px;
            opacity: 0;
            transition: opacity 0.2s ease;
        }
        
        .clickable-sub-item:hover::after {
            opacity: 1;
        }
        
        /* „É¢„Éº„ÉÄ„É´„Çπ„Çø„Ç§„É´ */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            backdrop-filter: blur(5px);
        }
        
        /* È°û‰ººÂ∫¶Ê§úÁ¥¢„Çπ„Çø„Ç§„É´ */
        .similarity-search-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            border-radius: 20px;
            padding: 8px 16px;
            font-size: 13px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
            transition: all 0.3s ease;
            z-index: 10;
        }
        
        .similarity-search-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(52, 152, 219, 0.4);
        }
        
        /* È°û‰ººÂ∫¶Ë°®Á§∫„Éê„ÉÉ„Ç∏ */
        .similarity-badge {
            position: absolute;
            top: 5px;
            left: 5px;
            background: white;
            border-radius: 15px;
            padding: 4px 10px;
            font-size: 12px;
            font-weight: bold;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            z-index: 5;
        }
        
        .similarity-high {
            color: #27ae60;
            border: 2px solid #27ae60;
        }
        
        .similarity-medium {
            color: #f39c12;
            border: 2px solid #f39c12;
        }
        
        .similarity-low {
            color: #e74c3c;
            border: 2px solid #e74c3c;
        }
        
        /* È°û‰ººÂ∫¶Ê§úÁ¥¢„É¢„Éº„ÉÄ„É´ */
        .similarity-modal {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 900px;
            max-height: 85vh;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow-y: auto;
        }
        
        .similarity-input-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 25px;
        }
        
        .similarity-input-group {
            margin-bottom: 15px;
        }
        
        .similarity-input-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
        }
        
        .similarity-input-group input,
        .similarity-input-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        
        .similarity-results {
            margin-top: 20px;
        }
        
        .similarity-result-item {
            background: linear-gradient(135deg, #fff, #f8f9fa);
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            position: relative;
            transition: all 0.3s ease;
        }
        
        .similarity-result-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }
        
        .similarity-score {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 24px;
            font-weight: bold;
        }
        
        .similarity-details {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #e0e0e0;
        }
        
        .similarity-chart {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .similarity-chart-label {
            width: 120px;
            font-size: 13px;
            color: #666;
        }
        
        .similarity-chart-bar {
            flex: 1;
            height: 20px;
            background: #e0e0e0;
            border-radius: 10px;
            margin: 0 10px;
            position: relative;
            overflow: hidden;
        }
        
        .similarity-chart-fill {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #2ecc71);
            border-radius: 10px;
            transition: width 0.5s ease;
        }
        
        .similarity-chart-value {
            font-size: 13px;
            font-weight: bold;
            color: #333;
        }
        
        .modal {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 800px;
            max-height: 80vh;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 15px;
        }
        
        .modal-title {
            font-size: 24px;
            font-weight: bold;
            color: #333;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: #666;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.2s ease;
        }
        
        .modal-close:hover {
            background: rgba(0,0,0,0.1);
            color: #333;
        }
        
        .activity-list {
            display: grid;
            gap: 12px;
        }
        
        .activity-item {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            transition: all 0.2s ease;
        }
        
        .activity-item:hover {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            border-color: #2196f3;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(33, 150, 243, 0.2);
        }
        
        .activity-id {
            font-family: 'Courier New', monospace;
            font-weight: bold;
            color: #1976d2;
            font-size: 14px;
            margin-bottom: 8px;
        }
        
        .activity-name {
            color: #333;
            font-size: 16px;
            margin-bottom: 6px;
            font-weight: 500;
        }
        
        .activity-description {
            color: #666;
            font-size: 13px;
            line-height: 1.4;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="title">ecoinvent „Ç¢„É´„Éü„Éã„Ç¶„É†„Ç´„ÉÜ„Ç¥„É™„Ç®„É™„Ç¢Âõ≥</div>
        
        <!-- ÊäΩË±°Ê§úÁ¥¢„Éê„Éº -->
        <div class="abstract-search-container" id="abstractSearchContainer">
            <div class="abstract-search-input-wrapper">
                <input type="text" id="abstractSearchInput" placeholder="‰æã: Êó•Êú¨„ÅÆÈõªÂäõ„ÄÅ„Ç¢„Ç∏„Ç¢„ÅÆ„Ç¢„É´„Éü„Éã„Ç¶„É†ÁîüÁî£„ÄÅetc." class="abstract-search-input">
                <button onclick="performAbstractSearch()" class="abstract-search-btn">üîç Ê§úÁ¥¢</button>
            </div>
            <div class="abstract-search-suggestions" id="searchSuggestions">
                <!-- Ê§úÁ¥¢ÂÄôË£ú„ÅåÂãïÁöÑ„Å´Ë°®Á§∫„Åï„Çå„Çã -->
            </div>
        </div>
        
        <!-- „Éë„É≥„Åè„Åö„Éä„Éì -->
        <div class="breadcrumb" id="breadcrumb">
            <span class="breadcrumb-item">„Ç¢„É´„Éü„Éã„Ç¶„É†ÂÖ®‰Ωì</span>
        </div>
        
        <!-- Êàª„Çã„Éú„Çø„É≥ -->
        <div class="back-button" id="backButton" onclick="goBack()">‚Üê Êàª„Çã</div>
        
        <div class="main-area fade-transition active" id="mainArea">
            <div class="main-title" id="mainTitle">„Ç¢„É´„Éü„Éã„Ç¶„É†ÂÖ®‰ΩìÈ†òÂüü (Aluminum Domain)</div>
            
            <!-- ‰∏äÈÉ®ÊÉÖÂ†±„Éë„Éç„É´ -->
            <div class="info-panel-top" id="infoPanelTop">
                <div class="info-title">„Ç®„É™„Ç¢ÊÉÖÂ†±</div>
                <div class="info-text" id="infoContentTop">
                    ÂêÑ„Ç®„É™„Ç¢„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶Ë©≥Á¥∞ÊÉÖÂ†±„ÇíË°®Á§∫„Åô„Çã„Åã„ÄÅË©≥Á¥∞„Ç®„É™„Ç¢„Å´ÁßªÂãï„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ<br>
                    „Åì„ÅÆÂõ≥„ÅØ„ÄÅecoinvent„Éá„Éº„Çø„Éô„Éº„Çπ„Å´„Åä„Åë„Çã„Ç¢„É´„Éü„Éã„Ç¶„É†Èñ¢ÈÄ£„Éó„É≠„Çª„Çπ„ÇíÂú∞ÁêÜÁöÑ„Ç®„É™„Ç¢„ÅÆ„Çà„ÅÜ„Å´Ë°®Áèæ„Åó„ÄÅ
                    „Åù„Çå„Åû„Çå„ÅÆÈ†òÂüüÂÜÖ„Å´Èñ¢ÈÄ£„Åô„Çã„Éó„É≠„Çª„Çπ„ÇÑ„Ç´„ÉÜ„Ç¥„É™„Çí„Ç∞„É´„Éº„ÉóÂåñ„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ
                </div>
            </div>
            
            <!-- ÂãïÁöÑ„Å´„Ç®„É™„Ç¢„ÅåÁîüÊàê„Åï„Çå„ÇãÂ†¥ÊâÄ -->
            <div id="areasContainer"></div>
        </div>
        
        <!-- Âá°‰æã -->
        <div class="legend">
            <div class="legend-title">„Ç®„É™„Ç¢ÂàÜÈ°û</div>
            <div id="legendContent">
                <!-- ÂãïÁöÑ„Å´ÁîüÊàê -->
            </div>
        </div>
    </div>
    
    <!-- Activity ID „É¢„Éº„ÉÄ„É´ -->
    <div class="modal-overlay" id="activityModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">Activity ID ‰∏ÄË¶ß</h2>
                <button class="modal-close" onclick="closeActivityModal()">&times;</button>
            </div>
            <div class="activity-list" id="activityList">
                <!-- ÂãïÁöÑ„Å´ÁîüÊàê„Åï„Çå„Çã -->
            </div>
        </div>
    </div>
    
    <!-- È°û‰ººÂ∫¶Ê§úÁ¥¢„É¢„Éº„ÉÄ„É´ -->
    <div class="modal-overlay" id="similarityModal">
        <div class="similarity-modal">
            <div class="modal-header">
                <h2 class="modal-title" id="similarityModalTitle">È°û‰ºº„Éó„É≠„Çª„ÇπÊ§úÁ¥¢</h2>
                <button class="modal-close" onclick="closeSimilarityModal()">&times;</button>
            </div>
            
            <div class="similarity-input-section">
                <h3>Êé¢„Åó„Å¶„ÅÑ„ÇãÊé°ÊéòÊñπÊ≥ï„ÅÆË©≥Á¥∞„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ</h3>
                <div class="similarity-input-group">
                    <label>Êé°ÊéòÊñπÊ≥ïÂêç:</label>
                    <input type="text" id="miningMethodName" placeholder="‰æã: Êµ∑Â∫ïÊé°Êéò„ÄÅÊ∫∂Ê∂≤Êé°Êéò„ÄÅetc.">
                </div>
                <div class="similarity-input-group">
                    <label>Êé°ÊéòÊ∑±Â∫¶:</label>
                    <select id="miningDepth">
                        <option value="surface">Âú∞Ë°®‰ªòËøëÔºà0-50mÔºâ</option>
                        <option value="shallow">ÊµÖÂ±§Ôºà50-200mÔºâ</option>
                        <option value="deep">Ê∑±Â±§Ôºà200m‰ª•‰∏äÔºâ</option>
                        <option value="underwater">Ê∞¥‰∏≠„ÉªÊµ∑Â∫ï</option>
                    </select>
                </div>
                <div class="similarity-input-group">
                    <label>Êé°ÊéòË¶èÊ®°:</label>
                    <select id="miningScale">
                        <option value="small">Â∞èË¶èÊ®°</option>
                        <option value="medium">‰∏≠Ë¶èÊ®°</option>
                        <option value="large">Â§ßË¶èÊ®°</option>
                    </select>
                </div>
                <button onclick="searchSimilarProcesses()" style="background: linear-gradient(135deg, #3498db, #2980b9); color: white; border: none; padding: 12px 24px; border-radius: 5px; cursor: pointer; font-weight: bold; margin-top: 10px;">È°û‰ºº„Éó„É≠„Çª„Çπ„ÇíÊ§úÁ¥¢</button>
            </div>
            
            <div class="similarity-results" id="similarityResults">
                <!-- Ê§úÁ¥¢ÁµêÊûú„ÅåÂãïÁöÑ„Å´Ë°®Á§∫„Åï„Çå„Çã -->
            </div>
        </div>
    </div>
    
    <script>
        // ÈöéÂ±§„Éá„Éº„ÇøÂÆöÁæ©
        const areaHierarchy = {
            "main": {
                "title": "„Ç¢„É´„Éü„Éã„Ç¶„É†ÂÖ®‰ΩìÈ†òÂüü (Aluminum Domain)",
                "areas": {
                    "primary_production": {
                        "name": "‰∏ÄÊ¨°„Ç¢„É´„Éü„Éã„Ç¶„É†ÁîüÁî£„Ç®„É™„Ç¢",
                        "color": "linear-gradient(135deg, #ff6b6b, #ee5a24)",
                        "position": {"top": 170, "left": 30, "width": 280, "height": 250},
                        "sub_items": [
                            "„Éú„Éº„Ç≠„Çµ„Ç§„ÉàÊé°Êéò„Éó„É≠„Çª„Çπ",
                            "„Ç¢„É´„Éü„ÉäÁ≤æË£Ω„Éó„É≠„Çª„Çπ", 
                            "ÈõªËß£Ë£ΩÈå¨„Éó„É≠„Çª„Çπ",
                            "Âú∞ÂüüÂà•ÁîüÁî£ (‰∏≠ÂõΩ)",
                            "Âú∞ÂüüÂà•ÁîüÁî£ (Ê¨ßÂ∑û)",
                            "Âú∞ÂüüÂà•ÁîüÁî£ (ÂåóÁ±≥)",
                            "Âú∞ÂüüÂà•ÁîüÁî£ („Åù„ÅÆ‰ªñ)"
                        ],
                        "has_detail": true,
                        "legend_color": "#ff6b6b"
                    },
                    "secondary_production": {
                        "name": "‰∫åÊ¨°„Ç¢„É´„Éü„Éã„Ç¶„É†ÁîüÁî£„Ç®„É™„Ç¢",
                        "color": "linear-gradient(135deg, #4ecdc4, #00b894)",
                        "position": {"top": 170, "right": 30, "width": 280, "height": 250},
                        "sub_items": [
                            "„Ç¢„É´„Éü„Çπ„ÇØ„É©„ÉÉ„ÉóÂõûÂèé",
                            "„Çπ„ÇØ„É©„ÉÉ„ÉóÂâçÂá¶ÁêÜ",
                            "Ê∫∂Ëß£„ÉªÁ≤æË£Ω„Éó„É≠„Çª„Çπ",
                            "ÂÜçÁîü„Ç§„É≥„Ç¥„ÉÉ„ÉàË£ΩÈÄ†",
                            "ÂìÅË≥™ÁÆ°ÁêÜ„ÉªÂàÜÊûê",
                            "„É™„Çµ„Ç§„ÇØ„É´ÂäπÁéáË©ï‰æ°"
                        ],
                        "has_detail": true,
                        "legend_color": "#4ecdc4"
                    },
                    "alloys": {
                        "name": "„Ç¢„É´„Éü„Éã„Ç¶„É†ÂêàÈáë„Ç®„É™„Ç¢", 
                        "color": "linear-gradient(135deg, #ffeaa7, #fdcb6e)",
                        "position": {"top": 460, "left": "50%", "transform": "translateX(-50%)", "width": 320, "height": 220},
                        "sub_items": [
                            "1000Á≥ª (Á¥î„Ç¢„É´„Éü„Éã„Ç¶„É†Á≥ª)",
                            "2000Á≥ª (Al-CuÁ≥ªÂêàÈáë)",
                            "3000Á≥ª (Al-MnÁ≥ªÂêàÈáë)", 
                            "5000Á≥ª (Al-MgÁ≥ªÂêàÈáë)",
                            "6000Á≥ª (Al-Mg-SiÁ≥ªÂêàÈáë)",
                            "7000Á≥ª (Al-ZnÁ≥ªÂêàÈáë)"
                        ],
                        "has_detail": true,
                        "legend_color": "#ffeaa7"
                    },
                    "processing": {
                        "name": "„Ç¢„É´„Éü„Éã„Ç¶„É†Âä†Â∑•„Ç®„É™„Ç¢",
                        "color": "linear-gradient(135deg, #45b7d1, #0984e3)",
                        "position": {"top": 720, "left": 30, "width": 320, "height": 260},
                        "sub_items": [
                            "ÂúßÂª∂Âä†Â∑• (ÊùøÊùêË£ΩÈÄ†)",
                            "ÂúßÂª∂Âä†Â∑• (ÁÆîË£ΩÈÄ†)",
                            "ÊäºÂá∫ÊàêÂΩ¢ (ÂΩ¢ÊùêË£ΩÈÄ†)",
                            "ÈçõÈÄ†Âä†Â∑• (È´òÂº∑Â∫¶ÈÉ®ÂìÅ)",
                            "Èã≥ÈÄ†Âä†Â∑• (Ë§áÈõëÂΩ¢Áä∂)",
                            "Ë°®Èù¢Âá¶ÁêÜ (ÈôΩÊ•µÈÖ∏Âåñ)",
                            "Ê©üÊ¢∞Âä†Â∑• (ÂàáÂâä„ÉªÁ†îÁ£®)",
                            "Ê∫∂Êé•„ÉªÊé•Âêà„Éó„É≠„Çª„Çπ"
                        ],
                        "has_detail": true,
                        "legend_color": "#45b7d1"
                    },
                    "products": {
                        "name": "„Ç¢„É´„Éü„Éã„Ç¶„É†Ë£ΩÂìÅ„Ç®„É™„Ç¢",
                        "color": "linear-gradient(135deg, #96ceb4, #55a3ff)",
                        "position": {"top": 720, "right": 30, "width": 320, "height": 260},
                        "sub_items": [
                            "Âª∫ÁØâÊùêÊñô (Á™ìÊû†„ÉªÂ§ñË£Ö)",
                            "Âª∫ÁØâÊùêÊñô (ÊßãÈÄ†Êùê)",
                            "Ëº∏ÈÄÅÁî® (Ëá™ÂãïËªäÈÉ®ÂìÅ)",
                            "Ëº∏ÈÄÅÁî® (Ëà™Á©∫Ê©üÈÉ®ÂìÅ)",
                            "ÂåÖË£ÖÊùêÊñô (Áº∂„ÉªÂÆπÂô®)",
                            "ÂåÖË£ÖÊùêÊñô (ÁÆî„Éª„Éï„Ç£„É´„É†)",
                            "ÈõªÂ≠êÈÉ®ÂìÅ (ÊîæÁÜ±Âô®)",
                            "ÈõªÂ≠êÈÉ®ÂìÅ (Á≠ê‰Ωì„Éª„Ç≥„Éç„ÇØ„Çø)"
                        ],
                        "has_detail": true,
                        "legend_color": "#96ceb4"
                    }
                }
            },
            
            // ‰∏ÄÊ¨°ÁîüÁî£„Ç®„É™„Ç¢„ÅÆË©≥Á¥∞
            "primary_production": {
                "title": "‰∏ÄÊ¨°„Ç¢„É´„Éü„Éã„Ç¶„É†ÁîüÁî£„Ç®„É™„Ç¢Ë©≥Á¥∞",
                "parent": "main",
                "areas": {
                    "bauxite_mining": {
                        "name": "„Éú„Éº„Ç≠„Çµ„Ç§„ÉàÊé°Êéò",
                        "color": "linear-gradient(135deg, #e74c3c, #c0392b)",
                        "position": {"top": 200, "left": 80, "width": 320, "height": 250},
                        "sub_items": [
                            "Èú≤Â§©Êéò„ÇäÊé°Êéò",
                            "Âú∞‰∏ãÊé°Êéò",
                            "Èâ±Áü≥ÂìÅË≥™ÁÆ°ÁêÜ",
                            "Áí∞Â¢ÉÂΩ±ÈüøË©ï‰æ°",
                            "Êé°ÊéòÂæåÂæ©Êóß"
                        ],
                        "has_detail": false,
                        "legend_color": "#e74c3c"
                    },
                    "alumina_refining": {
                        "name": "„Ç¢„É´„Éü„ÉäÁ≤æË£Ω",
                        "color": "linear-gradient(135deg, #c0392b, #a93226)",
                        "position": {"top": 200, "right": 80, "width": 320, "height": 250},
                        "sub_items": [
                            "„Éê„Ç§„É§„ÉºÊ≥ï„Éó„É≠„Çª„Çπ",
                            "Ëµ§Ê≥•Âá¶ÁêÜ",
                            "ÁµêÊô∂ÂåñÂ∑•Á®ã",
                            "ÁÑºÊàêÂ∑•Á®ã",
                            "ÂìÅË≥™Ê§úÊüª"
                        ],
                        "has_detail": false,
                        "legend_color": "#c0392b"
                    },
                    "electrolysis": {
                        "name": "ÈõªËß£Ë£ΩÈå¨",
                        "color": "linear-gradient(135deg, #a93226, #922b21)",
                        "position": {"top": 500, "left": "50%", "transform": "translateX(-50%)", "width": 380, "height": 280},
                        "sub_items": [
                            "„Éõ„Éº„É´„Éª„Ç®„É´„ÉºÊ≥ï",
                            "ÈõªËß£ÊßΩÁÆ°ÁêÜ",
                            "ÈôΩÊ•µ„ÉªÈô∞Ê•µÁÆ°ÁêÜ",
                            "ÈõªÂäõ‰æõÁµ¶„Ç∑„Çπ„ÉÜ„É†",
                            "Ê∫∂Ëûç„Ç¢„É´„Éü„Éã„Ç¶„É†Âá¶ÁêÜ"
                        ],
                        "has_detail": false,
                        "legend_color": "#a93226"
                    }
                }
            },
            
            // ‰∫åÊ¨°ÁîüÁî£„Ç®„É™„Ç¢„ÅÆË©≥Á¥∞
            "secondary_production": {
                "title": "‰∫åÊ¨°„Ç¢„É´„Éü„Éã„Ç¶„É†ÁîüÁî£„Ç®„É™„Ç¢Ë©≥Á¥∞",
                "parent": "main",
                "areas": {
                    "scrap_collection": {
                        "name": "„Çπ„ÇØ„É©„ÉÉ„ÉóÂõûÂèé„Ç∑„Çπ„ÉÜ„É†",
                        "color": "linear-gradient(135deg, #17a2b8, #138496)",
                        "position": {"top": 170, "left": 50, "width": 280, "height": 220},
                        "sub_items": [
                            "Âª∫ÁØâÂªÉÊùêÂõûÂèé",
                            "Ëá™ÂãïËªäËß£‰Ωì„Çπ„ÇØ„É©„ÉÉ„Éó",
                            "È£≤ÊñôÁº∂ÂõûÂèé",
                            "Áî£Ê•≠„Çπ„ÇØ„É©„ÉÉ„Éó",
                            "ÂàÜÂà•„Éª‰ªïÂàÜ„Åë„Ç∑„Çπ„ÉÜ„É†"
                        ],
                        "has_detail": false,
                        "legend_color": "#17a2b8"
                    },
                    "preprocessing": {
                        "name": "ÂâçÂá¶ÁêÜÂ∑•Á®ã",
                        "color": "linear-gradient(135deg, #138496, #0f6674)",
                        "position": {"top": 170, "right": 50, "width": 280, "height": 220},
                        "sub_items": [
                            "Á£ÅÊ∞óÂàÜÈõ¢",
                            "Ê∏¶ÈõªÊµÅÂàÜÈõ¢",
                            "Á†¥Á†ï„ÉªË£ÅÊñ≠",
                            "Ê¥óÊµÑ„ÉªËÑ±ËÑÇ",
                            "ÂêàÈáëÂàÜÂà•"
                        ],
                        "has_detail": false,
                        "legend_color": "#138496"
                    },
                    "melting_refining": {
                        "name": "Ê∫∂Ëß£„ÉªÁ≤æË£Ω„Éó„É≠„Çª„Çπ",
                        "color": "linear-gradient(135deg, #0f6674, #0a525a)",
                        "position": {"top": 420, "left": "50%", "transform": "translateX(-50%)", "width": 320, "height": 240},
                        "sub_items": [
                            "ÂèçÂ∞ÑÁÇâÊ∫∂Ëß£",
                            "ÂõûËª¢ÁÇâÊ∫∂Ëß£",
                            "„Éï„É©„ÉÉ„ÇØ„ÇπÂá¶ÁêÜ",
                            "„Ç¨„ÇπÈô§Âéª",
                            "‰ªãÂú®Áâ©Èô§Âéª"
                        ],
                        "has_detail": false,
                        "legend_color": "#0f6674"
                    },
                    "quality_control": {
                        "name": "ÂìÅË≥™ÁÆ°ÁêÜ„ÉªÂàÜÊûê",
                        "color": "linear-gradient(135deg, #0a525a, #073e47)",
                        "position": {"top": 690, "left": 50, "width": 280, "height": 200},
                        "sub_items": [
                            "ÂåñÂ≠¶ÊàêÂàÜÂàÜÊûê",
                            "Ê©üÊ¢∞ÁâπÊÄßË©¶È®ì",
                            "ÁµÑÁπîË¶≥ÂØü",
                            "‰∏çÁ¥îÁâ©Ê§úÊüª",
                            "„Éà„É¨„Éº„Çµ„Éì„É™„ÉÜ„Ç£"
                        ],
                        "has_detail": false,
                        "legend_color": "#0a525a"
                    },
                    "secondary_ingot": {
                        "name": "ÂÜçÁîü„Ç§„É≥„Ç¥„ÉÉ„ÉàË£ΩÈÄ†",
                        "color": "linear-gradient(135deg, #073e47, #042a2f)",
                        "position": {"top": 690, "right": 50, "width": 280, "height": 200},
                        "sub_items": [
                            "Èã≥ÈÄ†ÊäÄË°ì",
                            "ÂÜ∑Âç¥Âà∂Âæ°",
                            "Ë°®Èù¢‰ªï‰∏ä„Åí",
                            "ÂØ∏Ê≥ïÁ≤æÂ∫¶ÁÆ°ÁêÜ",
                            "Âá∫Ëç∑Ê∫ñÂÇô"
                        ],
                        "has_detail": false,
                        "legend_color": "#073e47"
                    }
                }
            }
        };
        
        // ÁèæÂú®„ÅÆÁä∂ÊÖãÁÆ°ÁêÜ
        let currentLevel = "main";
        let breadcrumb = ["„Ç¢„É´„Éü„Éã„Ç¶„É†ÂÖ®‰Ωì"];
        
        // „Éó„É≠„Çª„ÇπÈ°û‰ººÂ∫¶„Éá„Éº„Çø
        const processSimilarityData = {
            "Êé°ÊéòÊñπÊ≥ï": {
                "Èú≤Â§©Êéò„ÇäÊé°Êéò": {
                    characteristics: {
                        Ê∑±Â∫¶: "surface",
                        Áí∞Â¢ÉÂΩ±Èüø: 80,
                        „Ç≥„Çπ„Éà: 60,
                        ÁîüÁî£ÂäπÁéá: 90,
                        ÂÆâÂÖ®ÊÄß: 85,
                        „Ç®„Éç„É´„ÇÆ„ÉºÊ∂àË≤ª: 70
                    }
                },
                "Âú∞‰∏ãÊé°Êéò": {
                    characteristics: {
                        Ê∑±Â∫¶: "deep",
                        Áí∞Â¢ÉÂΩ±Èüø: 40,
                        „Ç≥„Çπ„Éà: 90,
                        ÁîüÁî£ÂäπÁéá: 60,
                        ÂÆâÂÖ®ÊÄß: 50,
                        „Ç®„Éç„É´„ÇÆ„ÉºÊ∂àË≤ª: 85
                    }
                }
            }
        };
        
        // È°û‰ººÂ∫¶Ë®àÁÆóÈñ¢Êï∞
        function calculateSimilarity(target, existing) {
            const weights = {
                Ê∑±Â∫¶: 0.25,
                Áí∞Â¢ÉÂΩ±Èüø: 0.2,
                „Ç≥„Çπ„Éà: 0.2,
                ÁîüÁî£ÂäπÁéá: 0.15,
                ÂÆâÂÖ®ÊÄß: 0.1,
                „Ç®„Éç„É´„ÇÆ„ÉºÊ∂àË≤ª: 0.1
            };
            
            let totalScore = 0;
            let details = {};
            
            // Ê∑±Â∫¶„ÅÆÈ°û‰ººÂ∫¶
            const depthScore = target.Ê∑±Â∫¶ === existing.characteristics.Ê∑±Â∫¶ ? 100 : 
                              (target.Ê∑±Â∫¶ === "shallow" && existing.characteristics.Ê∑±Â∫¶ === "surface") ? 70 : 
                              (target.Ê∑±Â∫¶ === "underwater" && existing.characteristics.Ê∑±Â∫¶ === "surface") ? 30 : 50;
            
            details.Ê∑±Â∫¶ = depthScore;
            totalScore += depthScore * weights.Ê∑±Â∫¶;
            
            // „Åù„ÅÆ‰ªñ„ÅÆÁâπÊÄßÔºà‰ªÆ„ÅÆÂÄ§Ôºâ
            const otherScores = {
                Áí∞Â¢ÉÂΩ±Èüø: Math.max(0, 100 - Math.abs(target.Áí∞Â¢ÉÂΩ±Èüø - existing.characteristics.Áí∞Â¢ÉÂΩ±Èüø)),
                „Ç≥„Çπ„Éà: Math.max(0, 100 - Math.abs(target.„Ç≥„Çπ„Éà - existing.characteristics.„Ç≥„Çπ„Éà)),
                ÁîüÁî£ÂäπÁéá: Math.max(0, 100 - Math.abs(target.ÁîüÁî£ÂäπÁéá - existing.characteristics.ÁîüÁî£ÂäπÁéá)),
                ÂÆâÂÖ®ÊÄß: Math.max(0, 100 - Math.abs(target.ÂÆâÂÖ®ÊÄß - existing.characteristics.ÂÆâÂÖ®ÊÄß)),
                „Ç®„Éç„É´„ÇÆ„ÉºÊ∂àË≤ª: Math.max(0, 100 - Math.abs(target.„Ç®„Éç„É´„ÇÆ„ÉºÊ∂àË≤ª - existing.characteristics.„Ç®„Éç„É´„ÇÆ„ÉºÊ∂àË≤ª))
            };
            
            Object.keys(otherScores).forEach(key => {
                details[key] = otherScores[key];
                totalScore += otherScores[key] * weights[key];
            });
            
            return {
                total: Math.round(totalScore),
                details: details
            };
        }
        
        // Activity ID „Çµ„É≥„Éó„É´„Éá„Éº„Çø
        const activityData = {
            "Èú≤Â§©Êéò„ÇäÊé°Êéò": {
                title: "Èú≤Â§©Êéò„ÇäÊé°Êéò - Activity ID ‰∏ÄË¶ß",
                activities: [
                    {
                        id: "bauxite_mining_openpit_001",
                        name: "„Éú„Éº„Ç≠„Çµ„Ç§„ÉàÊé°ÊéòÔºàÈú≤Â§©Êéò„Çä„ÄÅ„Ç™„Éº„Çπ„Éà„É©„É™„Ç¢Ôºâ",
                        description: "„Ç™„Éº„Çπ„Éà„É©„É™„Ç¢„Å´„Åä„Åë„Çã„Éú„Éº„Ç≠„Çµ„Ç§„ÉàÈâ±Áü≥„ÅÆÈú≤Â§©Êé°Êéò„Éó„É≠„Çª„Çπ„ÄÇÂ§ßÂûãÈáçÊ©ü„Çí‰ΩøÁî®„Åó„ÅüË°®ÂúüÂâ•Èõ¢„Å®Êé°Êéò‰ΩúÊ•≠„ÇíÂê´„ÇÄ„ÄÇ"
                    },
                    {
                        id: "bauxite_mining_openpit_002", 
                        name: "„Éú„Éº„Ç≠„Çµ„Ç§„ÉàÊé°ÊéòÔºàÈú≤Â§©Êéò„Çä„ÄÅ„Éñ„É©„Ç∏„É´Ôºâ",
                        description: "„Éñ„É©„Ç∏„É´„Ç¢„Éû„Çæ„É≥Âú∞Âüü„Åß„ÅÆ„Éú„Éº„Ç≠„Çµ„Ç§„ÉàÊé°Êéò„ÄÇÁí∞Â¢ÉÈÖçÊÖÆÂûã„ÅÆÊé°ÊéòÊâãÊ≥ï„Å®ÂúüÂú∞Âæ©Êóß„Éó„É≠„Ç∞„É©„É†„ÇíÂê´„ÇÄ„ÄÇ"
                    },
                    {
                        id: "bauxite_mining_openpit_003",
                        name: "„Éú„Éº„Ç≠„Çµ„Ç§„ÉàÊé°ÊéòÔºàÈú≤Â§©Êéò„Çä„ÄÅ„ÇÆ„Éã„Ç¢Ôºâ",
                        description: "Ë•ø„Ç¢„Éï„É™„Ç´„ÇÆ„Éã„Ç¢„Åß„ÅÆÈ´òÂìÅ‰Ωç„Éú„Éº„Ç≠„Çµ„Ç§„ÉàÊé°Êéò„ÄÇÊ∏ØÊπæËº∏ÈÄÅ„Ç§„É≥„Éï„É©„Å®„ÅÆÁµ±Âêà„Éó„É≠„Çª„Çπ„ÄÇ"
                    },
                    {
                        id: "bauxite_mining_openpit_004",
                        name: "„Éú„Éº„Ç≠„Çµ„Ç§„ÉàÊé°ÊéòÔºàÈú≤Â§©Êéò„Çä„ÄÅ„Ç∏„É£„Éû„Ç§„Ç´Ôºâ",
                        description: "„Ç´„É™„ÉñÊµ∑Âú∞Âüü„Åß„ÅÆ‰∏≠ÂìÅ‰Ωç„Éú„Éº„Ç≠„Çµ„Ç§„ÉàÊé°Êéò„ÄÇÂ≥∂Â∂ºÈÉ®ÁâπÊúâ„ÅÆÁâ©ÊµÅÂà∂Á¥Ñ„ÇíËÄÉÊÖÆ„Åó„Åü„Éó„É≠„Çª„Çπ„ÄÇ"
                    },
                    {
                        id: "bauxite_mining_openpit_005",
                        name: "„Éú„Éº„Ç≠„Çµ„Ç§„ÉàÊé°ÊéòÔºàÈú≤Â§©Êéò„Çä„ÄÅ„Ç§„É≥„ÉâÔºâ",
                        description: "„Ç§„É≥„ÉâÊù±ÈÉ®„Åß„ÅÆÂ∞èË¶èÊ®°ÂàÜÊï£Âûã„Éú„Éº„Ç≠„Çµ„Ç§„ÉàÊé°Êéò„ÄÇÂú∞Âüü„Ç≥„Éü„É•„Éã„ÉÜ„Ç£„Å®„ÅÆÂçîÂÉçÊé°Êéò„Éó„É≠„Ç∞„É©„É†„ÄÇ"
                    }
                ]
            }
        };
        
        // „Ç®„É™„Ç¢Ë©≥Á¥∞ÊÉÖÂ†±
        const areaInfo = {
            // „É°„Ç§„É≥„É¨„Éô„É´
            primary: {
                title: '‰∏ÄÊ¨°„Ç¢„É´„Éü„Éã„Ç¶„É†ÁîüÁî£„Ç®„É™„Ç¢',
                content: `<strong>ÂéüÊñô„Åã„ÇâÊñ∞Ë¶è„Ç¢„É´„Éü„Éã„Ç¶„É†„ÇíÁîüÁî£„Åô„ÇãÈ†òÂüü</strong><br>
                „Åì„ÅÆ„Ç®„É™„Ç¢„Åß„ÅØ„ÄÅ„Éú„Éº„Ç≠„Çµ„Ç§„ÉàÈâ±Áü≥„Åã„ÇâÈáëÂ±û„Ç¢„É´„Éü„Éã„Ç¶„É†„Åæ„Åß„ÅÆÂÖ®Â∑•Á®ã„ÇíÁÆ°ÁêÜ„Åó„Åæ„Åô„ÄÇ
                ‰∏ªË¶Å„Éó„É≠„Çª„ÇπÔºö„Éú„Éº„Ç≠„Çµ„Ç§„ÉàÊé°Êéò„ÄÅ„Ç¢„É´„Éü„ÉäÁ≤æË£Ω„ÄÅÈõªËß£Ë£ΩÈå¨„ÄÅÂú∞ÂüüÂà•ÊúÄÈÅ©Âåñ„ÄÇ
                Áí∞Â¢ÉË≤†Ëç∑ÔºöÈ´ò„Ç®„Éç„É´„ÇÆ„ÉºÊ∂àË≤ªÔºàÁ¥Ñ15kWh/kgÔºâ`
            },
            secondary: {
                title: '‰∫åÊ¨°„Ç¢„É´„Éü„Éã„Ç¶„É†ÁîüÁî£„Ç®„É™„Ç¢',
                content: `<strong>„É™„Çµ„Ç§„ÇØ„É´„Ç¢„É´„Éü„Éã„Ç¶„É†„ÅÆÁîüÁî£È†òÂüü</strong><br>
                ‰ΩøÁî®Ê∏à„Åø„Ç¢„É´„Éü„Éã„Ç¶„É†Ë£ΩÂìÅ„ÇíÂéüÊñô„Å®„Åó„Å¶„ÄÅÊñ∞„Åó„ÅÑ„Ç¢„É´„Éü„Éã„Ç¶„É†„ÇíÁîüÁî£„Åô„ÇãÂæ™Áí∞Âûã„Ç®„É™„Ç¢„Åß„Åô„ÄÇ
                ‰∏ªË¶Å„Éó„É≠„Çª„ÇπÔºö„Çπ„ÇØ„É©„ÉÉ„ÉóÂõûÂèé„ÄÅÂâçÂá¶ÁêÜ„ÄÅÊ∫∂Ëß£Á≤æË£Ω„ÄÅÂÜçÁîü„Ç§„É≥„Ç¥„ÉÉ„ÉàË£ΩÈÄ†„ÄÇ
                Áí∞Â¢É„É°„É™„ÉÉ„ÉàÔºö‰∏ÄÊ¨°ÁîüÁî£ÊØî95%„ÅÆ„Ç®„Éç„É´„ÇÆ„ÉºÂâäÊ∏õÂäπÊûú`
            },
            alloys: {
                title: '„Ç¢„É´„Éü„Éã„Ç¶„É†ÂêàÈáë„Ç®„É™„Ç¢',
                content: `<strong>Áî®ÈÄîÂà•ÂêàÈáëË®≠Ë®à„ÉªË£ΩÈÄ†„ÅÆ‰∏≠ÂøÉÈ†òÂüü</strong><br>
                Á¥î„Ç¢„É´„Éü„Éã„Ç¶„É†„Å´ÂêÑÁ®ÆÂÖÉÁ¥†„ÇíÊ∑ªÂä†„Åó„Å¶„ÄÅÁî®ÈÄî„Å´Âøú„Åò„ÅüÁâπÊÄß„ÇíÊåÅ„Å§ÂêàÈáë„ÇíË®≠Ë®à„ÉªË£ΩÈÄ†„Åô„Çã„Ç®„É™„Ç¢„Åß„Åô„ÄÇ
                ÂêàÈáëÁ≥ªÁµ±Ôºö1000Á≥ªÔºàÁ¥îÂ∫¶99%‰ª•‰∏äÔºâ„ÄÅ2000Á≥ªÔºàÈäÖÊ∑ªÂä†„ÄÅÈ´òÂº∑Â∫¶Ôºâ„ÄÅ5000Á≥ªÔºà„Éû„Ç∞„Éç„Ç∑„Ç¶„É†Ê∑ªÂä†Ôºâ„ÄÅ6000Á≥ªÔºàÊßãÈÄ†ÊùêÔºâ„ÄÇ
                ÂìÅË≥™ÁÆ°ÁêÜÔºöÊàêÂàÜÂàÜÊûê„ÉªÊ©üÊ¢∞ÁâπÊÄßË©¶È®ì„ÉªÁµÑÁπîË¶≥ÂØü`
            },
            processing: {
                title: '„Ç¢„É´„Éü„Éã„Ç¶„É†Âä†Â∑•„Ç®„É™„Ç¢',
                content: `<strong>„Ç§„É≥„Ç¥„ÉÉ„Éà„Åã„ÇâÊúÄÁµÇÂΩ¢Áä∂„Å∏„ÅÆÂä†Â∑•È†òÂüü</strong><br>
                „Ç¢„É´„Éü„Éã„Ç¶„É†„Ç§„É≥„Ç¥„ÉÉ„Éà„ÇÑÂêàÈáë„ÇíÊßò„ÄÖ„Å™Âä†Â∑•ÊäÄË°ì„Å´„Çà„ÇäÊúÄÁµÇË£ΩÂìÅÂΩ¢Áä∂„Å´ÊàêÂΩ¢„Åô„Çã„Ç®„É™„Ç¢„Åß„Åô„ÄÇ
                ‰∏ªË¶ÅÂä†Â∑•ÊäÄË°ìÔºöÂúßÂª∂ÔºàÊùøÊùê„ÉªÁÆîÔºâ„ÄÅÊäºÂá∫ÔºàË§áÈõëÊñ≠Èù¢ÂΩ¢ÊùêÔºâ„ÄÅÈçõÈÄ†ÔºàÈ´òÂº∑Â∫¶ÈÉ®ÂìÅÔºâ„ÄÅÈã≥ÈÄ†ÔºàË§áÈõëÂΩ¢Áä∂Ôºâ„ÄÅË°®Èù¢Âá¶ÁêÜ„ÄÇ
                ÂìÅË≥™‰øùË®ºÔºöÂØ∏Ê≥ïÁ≤æÂ∫¶„ÉªË°®Èù¢ÂìÅË≥™„ÉªÊ©üÊ¢∞ÁâπÊÄßÁÆ°ÁêÜ`
            },
            products: {
                title: '„Ç¢„É´„Éü„Éã„Ç¶„É†Ë£ΩÂìÅ„Ç®„É™„Ç¢',
                content: `<strong>ÊúÄÁµÇÁî®ÈÄîÂà•Ë£ΩÂìÅ„ÅÆÂøúÁî®È†òÂüü</strong><br>
                Âä†Â∑•„Åï„Çå„Åü„Ç¢„É´„Éü„Éã„Ç¶„É†ÊùêÊñô„Åå„ÄÅÂêÑÁî£Ê•≠ÂàÜÈáé„ÅÆÊúÄÁµÇË£ΩÂìÅ„Å®„Åó„Å¶ÂøúÁî®„Åï„Çå„ÇãÈ†òÂüü„Åß„Åô„ÄÇ
                ‰∏ªË¶ÅÂøúÁî®ÂàÜÈáéÔºöÂª∫ÁØâÔºàÁ™ìÊû†„ÉªÊßãÈÄ†ÊùêÔºâ„ÄÅËº∏ÈÄÅÔºàËá™ÂãïËªä„ÉªËà™Á©∫Ê©üÔºâ„ÄÅÂåÖË£ÖÔºàÁº∂„ÉªÂÆπÂô®Ôºâ„ÄÅÈõªÂ≠êÔºàÊîæÁÜ±Âô®„ÉªÁ≠ê‰ΩìÔºâ„ÄÇ
                „É©„Ç§„Éï„Çµ„Ç§„ÇØ„É´Ôºö‰ΩøÁî®‚ÜíÂõûÂèé‚Üí„É™„Çµ„Ç§„ÇØ„É´„Å∏„ÅÆÂæ™Áí∞`
            },
            // Ë©≥Á¥∞„É¨„Éô„É´
            bauxite_mining: {
                title: '„Éú„Éº„Ç≠„Çµ„Ç§„ÉàÊé°Êéò',
                content: `<strong>„Ç¢„É´„Éü„Éã„Ç¶„É†„ÅÆÂéüÊñô„Å®„Å™„Çã„Éú„Éº„Ç≠„Çµ„Ç§„ÉàÈâ±Áü≥„ÅÆÊé°ÊéòÂ∑•Á®ã</strong><br>
                ‰∏ª„Å´Èú≤Â§©Êéò„Çä„ÅßÊé°Êéò„Åï„Çå„ÄÅÂìÅË≥™ÁÆ°ÁêÜ„Å®Áí∞Â¢ÉÈÖçÊÖÆ„ÅåÈáçË¶Å„ÄÇÊé°ÊéòÂæå„ÅÆÂúüÂú∞Âæ©Êóß„ÇÇÂê´„ÇÄÊåÅÁ∂öÂèØËÉΩ„Å™Êé°Êéò„ÅåÊ±Ç„ÇÅ„Çâ„Çå„Åæ„Åô„ÄÇ`
            },
            alumina_refining: {
                title: '„Ç¢„É´„Éü„ÉäÁ≤æË£Ω',
                content: `<strong>„Éú„Éº„Ç≠„Çµ„Ç§„Éà„Åã„Çâ„Ç¢„É´„Éü„ÉäÔºàÈÖ∏Âåñ„Ç¢„É´„Éü„Éã„Ç¶„É†Ôºâ„ÇíÊäΩÂá∫„Åô„ÇãÂ∑•Á®ã</strong><br>
                „Éê„Ç§„É§„ÉºÊ≥ï„Çí‰ΩøÁî®„Åó„ÄÅËµ§Ê≥•„Å®„ÅÑ„ÅÜÂâØÁî£Áâ©„ÅÆÈÅ©Âàá„Å™Âá¶ÁêÜ„ÅåÁí∞Â¢É‰∏ä„ÅÆË™≤È°å„Å®„Å™„Å£„Å¶„ÅÑ„Åæ„Åô„ÄÇ`
            },
            electrolysis: {
                title: 'ÈõªËß£Ë£ΩÈå¨',
                content: `<strong>„Ç¢„É´„Éü„Éä„Åã„ÇâÈáëÂ±û„Ç¢„É´„Éü„Éã„Ç¶„É†„ÇíË£ΩÈå¨„Åô„ÇãÂ∑•Á®ã</strong><br>
                „Éõ„Éº„É´„Éª„Ç®„É´„ÉºÊ≥ï„Å´„Çà„Çä„ÄÅÂ§ßÈáè„ÅÆÈõªÂäõ„Çí‰ΩøÁî®„Åó„Å¶„Ç¢„É´„Éü„Éã„Ç¶„É†„ÇíÁîüÁî£„Åó„Åæ„Åô„ÄÇ„Ç®„Éç„É´„ÇÆ„ÉºÂäπÁéá„ÅåÈáçË¶Å„Å™Ë¶ÅÁ¥†„Åß„Åô„ÄÇ`
            },
            scrap_collection: {
                title: '„Çπ„ÇØ„É©„ÉÉ„ÉóÂõûÂèé„Ç∑„Çπ„ÉÜ„É†',
                content: `<strong>‰ΩøÁî®Ê∏à„Åø„Ç¢„É´„Éü„Éã„Ç¶„É†Ë£ΩÂìÅ„ÅÆÂäπÁéáÁöÑ„Å™ÂõûÂèé„Ç∑„Çπ„ÉÜ„É†</strong><br>
                Âª∫ÁØâ„ÄÅËº∏ÈÄÅ„ÄÅÂåÖË£Ö„Å™„Å©ÂêÑÂàÜÈáé„Åã„Çâ„ÅÆÂõûÂèé„Éç„ÉÉ„Éà„ÉØ„Éº„ÇØ„Å®ÂàÜÂà•„Ç∑„Çπ„ÉÜ„É†„ÅåÈáçË¶Å„Åß„Åô„ÄÇ`
            },
            preprocessing: {
                title: 'ÂâçÂá¶ÁêÜÂ∑•Á®ã',
                content: `<strong>„Çπ„ÇØ„É©„ÉÉ„Éó„ÅÆÊ∫∂Ëß£ÂâçÊ∫ñÂÇôÂ∑•Á®ã</strong><br>
                Á£ÅÊ∞óÂàÜÈõ¢„ÇÑÊ∏¶ÈõªÊµÅÂàÜÈõ¢„Å´„Çà„Çä‰ªñ„ÅÆÈáëÂ±û„ÇíÈô§Âéª„Åó„ÄÅÁ†¥Á†ï„ÉªÊ¥óÊµÑ„ÇíË°å„Å£„Å¶Ê∫∂Ëß£„Å´ÈÅ©„Åó„ÅüÁä∂ÊÖã„Å´„Åó„Åæ„Åô„ÄÇ`
            },
            melting_refining: {
                title: 'Ê∫∂Ëß£„ÉªÁ≤æË£Ω„Éó„É≠„Çª„Çπ',
                content: `<strong>„Çπ„ÇØ„É©„ÉÉ„Éó„Åã„ÇâÈ´òÂìÅË≥™„Ç¢„É´„Éü„Éã„Ç¶„É†„Å∏„ÅÆÂ§âÊèõ</strong><br>
                ÂèçÂ∞ÑÁÇâ„ÇÑÂõûËª¢ÁÇâ„Å´„Çà„ÇãÊ∫∂Ëß£„ÄÅ„Éï„É©„ÉÉ„ÇØ„ÇπÂá¶ÁêÜ„Å´„Çà„Çã„Ç¨„Çπ„Éª‰ªãÂú®Áâ©Èô§Âéª„Å´„Çà„Çä„ÄÅ
                ‰∏ÄÊ¨°„Ç¢„É´„Éü„Éã„Ç¶„É†„Å®ÂêåÁ≠âÂìÅË≥™„ÅÆÂÜçÁîü„Ç¢„É´„Éü„Éã„Ç¶„É†„ÇíË£ΩÈÄ†„Åó„Åæ„Åô„ÄÇ`
            },
            quality_control: {
                title: 'ÂìÅË≥™ÁÆ°ÁêÜ„ÉªÂàÜÊûê',
                content: `<strong>Ë£ΩÂìÅÂìÅË≥™‰øùË®º„ÅÆ„Åü„ÇÅ„ÅÆÁ∑èÂêàÂàÜÊûê„Ç∑„Çπ„ÉÜ„É†</strong><br>
                ÂåñÂ≠¶ÊàêÂàÜÂàÜÊûê„ÄÅÊ©üÊ¢∞ÁâπÊÄßË©¶È®ì„ÄÅÁµÑÁπîË¶≥ÂØü„ÇíÈÄö„Åò„Å¶ÂìÅË≥™„Çí‰øùË®º„ÄÇ
                „Éà„É¨„Éº„Çµ„Éì„É™„ÉÜ„Ç£„Ç∑„Çπ„ÉÜ„É†„Å´„Çà„ÇäÂéüÊñô„Åã„ÇâË£ΩÂìÅ„Åæ„ÅßËøΩË∑°ÂèØËÉΩ„Åß„Åô„ÄÇ`
            },
            secondary_ingot: {
                title: 'ÂÜçÁîü„Ç§„É≥„Ç¥„ÉÉ„ÉàË£ΩÈÄ†',
                content: `<strong>„É™„Çµ„Ç§„ÇØ„É´„Ç¢„É´„Éü„Éã„Ç¶„É†„ÅÆÊúÄÁµÇÂΩ¢ÊÖã</strong><br>
                Á≤æÂØÜ„Å™Èã≥ÈÄ†ÊäÄË°ì„Å®ÂÜ∑Âç¥Âà∂Âæ°„Å´„Çà„Çä„ÄÅÁî®ÈÄî„Å´Âøú„Åò„ÅüÂìÅË≥™„ÅÆÂÜçÁîü„Ç§„É≥„Ç¥„ÉÉ„Éà„ÇíË£ΩÈÄ†„ÄÇ
                ‰∏ÄÊ¨°„Ç§„É≥„Ç¥„ÉÉ„Éà„Å®ÂêåÁ≠â„ÅÆÂìÅË≥™„ÇíÂÆüÁèæ„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ`
            }
        };
        
        // È°û‰ººÂ∫¶Ê§úÁ¥¢„É¢„Éº„Éâ„ÅÆÁä∂ÊÖã
        let similaritySearchMode = false;
        let targetProcess = null;
        
        // ÂàùÊúüË°®Á§∫
        document.addEventListener('DOMContentLoaded', function() {
            renderCurrentLevel();
        });
        
        // ÁèæÂú®„ÅÆ„É¨„Éô„É´„ÇíÊèèÁîª
        function renderCurrentLevel() {
            const levelData = areaHierarchy[currentLevel];
            const container = document.getElementById('areasContainer');
            const mainTitle = document.getElementById('mainTitle');
            const backButton = document.getElementById('backButton');
            
            // „Çø„Ç§„Éà„É´Êõ¥Êñ∞
            mainTitle.textContent = levelData.title;
            
            // Êàª„Çã„Éú„Çø„É≥„ÅÆË°®Á§∫/ÈùûË°®Á§∫
            if (currentLevel !== 'main') {
                backButton.style.display = 'block';
            } else {
                backButton.style.display = 'none';
            }
            
            // „Ç≥„É≥„ÉÜ„Éä„Çí„ÇØ„É™„Ç¢
            container.innerHTML = '';
            
            // „Ç®„É™„Ç¢„ÇíÁîüÊàê
            Object.keys(levelData.areas).forEach(areaKey => {
                const areaData = levelData.areas[areaKey];
                const areaElement = createAreaElement(areaKey, areaData);
                container.appendChild(areaElement);
            });
            
            // Âá°‰æã„ÇíÊõ¥Êñ∞
            updateLegend(levelData.areas);
            
            // „Éë„É≥„Åè„Åö„ÇíÊõ¥Êñ∞
            updateBreadcrumb();
        }
        
        // „Ç®„É™„Ç¢Ë¶ÅÁ¥†„Çí‰ΩúÊàê
        function createAreaElement(areaKey, areaData) {
            const area = document.createElement('div');
            area.className = `area ${areaData.has_detail ? 'clickable' : ''}`;
            area.style.background = areaData.color;
            area.setAttribute('data-key', areaKey);
            
            // ‰ΩçÁΩÆË®≠ÂÆö
            const pos = areaData.position;
            
            // „É¢„Éê„Ç§„É´Âêë„Åë„Å´Ë™øÊï¥„Åï„Çå„Åü‰ΩçÁΩÆÊÉÖÂ†±„ÇíÈÅ©Áî®
            if (window.innerWidth <= 768) {
                // „É¢„Éê„Ç§„É´„Åß„ÅØÁ∏¶„Å´ÈÖçÁΩÆ
                const mobilePositions = {
                    // „É°„Ç§„É≥„É¨„Éô„É´
                    'primary_production': { top: '170px', left: '10px', right: 'auto', width: 'calc(100% - 20px)', height: '220px' },
                    'secondary_production': { top: '410px', left: '10px', right: 'auto', width: 'calc(100% - 20px)', height: '220px' },
                    'alloys': { top: '650px', left: '10px', right: 'auto', width: 'calc(100% - 20px)', height: '220px' },
                    'processing': { top: '890px', left: '10px', right: 'auto', width: 'calc(100% - 20px)', height: '240px' },
                    'products': { top: '1150px', left: '10px', right: 'auto', width: 'calc(100% - 20px)', height: '240px' },
                    
                    // ‰∏ÄÊ¨°ÁîüÁî£„Ç®„É™„Ç¢Ë©≥Á¥∞
                    'bauxite_mining': { top: '200px', left: '10px', right: 'auto', width: 'calc(100% - 20px)', height: '220px' },
                    'alumina_refining': { top: '440px', left: '10px', right: 'auto', width: 'calc(100% - 20px)', height: '220px' },
                    'electrolysis': { top: '680px', left: '10px', right: 'auto', width: 'calc(100% - 20px)', height: '250px' },
                    
                    // ‰∫åÊ¨°ÁîüÁî£„Ç®„É™„Ç¢Ë©≥Á¥∞
                    'scrap_collection': { top: '170px', left: '10px', right: 'auto', width: 'calc(100% - 20px)', height: '200px' },
                    'preprocessing': { top: '390px', left: '10px', right: 'auto', width: 'calc(100% - 20px)', height: '200px' },
                    'melting_refining': { top: '610px', left: '10px', right: 'auto', width: 'calc(100% - 20px)', height: '220px' },
                    'quality_control': { top: '850px', left: '10px', right: 'auto', width: 'calc(100% - 20px)', height: '180px' },
                    'secondary_ingot': { top: '1050px', left: '10px', right: 'auto', width: 'calc(100% - 20px)', height: '180px' }
                };
                
                const areaKey = Object.keys(areaHierarchy[currentLevel].areas).find(key => 
                    areaHierarchy[currentLevel].areas[key] === areaData
                );
                
                if (mobilePositions[areaKey]) {
                    Object.keys(mobilePositions[areaKey]).forEach(prop => {
                        area.style[prop] = mobilePositions[areaKey][prop];
                    });
                } else {
                    // „Éá„Éï„Ç©„É´„Éà„ÅÆ‰ΩçÁΩÆË®≠ÂÆö
                    Object.keys(pos).forEach(prop => {
                        if (prop === 'left' && pos[prop].toString().includes('%')) {
                            area.style.left = pos[prop];
                        } else if (prop === 'right') {
                            area.style.right = pos[prop] + 'px';
                        } else if (prop === 'transform') {
                            area.style.transform = pos[prop];
                        } else if (typeof pos[prop] === 'number') {
                            area.style[prop] = pos[prop] + 'px';
                        } else {
                            area.style[prop] = pos[prop];
                        }
                    });
                }
            } else {
                // „Éá„Çπ„ÇØ„Éà„ÉÉ„Éó„ÅÆ‰ΩçÁΩÆË®≠ÂÆö
                Object.keys(pos).forEach(prop => {
                    if (prop === 'left' && pos[prop].toString().includes('%')) {
                        area.style.left = pos[prop];
                    } else if (prop === 'right') {
                        area.style.right = pos[prop] + 'px';
                    } else if (prop === 'transform') {
                        area.style.transform = pos[prop];
                    } else if (typeof pos[prop] === 'number') {
                        area.style[prop] = pos[prop] + 'px';
                    } else {
                        area.style[prop] = pos[prop];
                    }
                });
            }
            
            // „ÇØ„É™„ÉÉ„ÇØ„Ç§„Éô„É≥„Éà
            if (areaData.has_detail) {
                area.addEventListener('click', () => navigateToDetail(areaKey));
            } else {
                area.addEventListener('click', () => showAreaInfo(areaKey));
            }
            
            // „Éõ„Éê„Éº„Ç§„Éô„É≥„Éà„ÇíËøΩÂä†
            area.addEventListener('mouseenter', () => {
                showAreaInfo(areaKey);
                area.classList.add('info-hover');
            });
            area.addEventListener('mouseleave', () => {
                showDefaultInfo();
                area.classList.remove('info-hover');
            });
            
            // „Çø„Ç§„Éà„É´
            const title = document.createElement('div');
            title.className = 'area-title';
            title.textContent = areaData.name;
            area.appendChild(title);
            
            // È°û‰ººÂ∫¶Ê§úÁ¥¢„Éú„Çø„É≥„ÇíËøΩÂä†Ôºà„Éú„Éº„Ç≠„Çµ„Ç§„ÉàÊé°Êéò„Ç®„É™„Ç¢„ÅÆÂ†¥ÂêàÔºâ
            if (areaKey === 'bauxite_mining' && currentLevel === 'primary_production') {
                const searchBtn = document.createElement('button');
                searchBtn.className = 'similarity-search-btn';
                searchBtn.textContent = 'üîç È°û‰ºº„Éó„É≠„Çª„ÇπÊ§úÁ¥¢';
                searchBtn.onclick = (e) => {
                    e.stopPropagation();
                    openSimilarityModal('bauxite_mining');
                };
                area.appendChild(searchBtn);
            }
            
            // „Ç≥„É≥„ÉÜ„É≥„ÉÑ
            const content = document.createElement('div');
            content.className = 'area-content';
            
            areaData.sub_items.forEach(item => {
                const subItem = document.createElement('div');
                subItem.className = 'sub-item';
                
                // Èú≤Â§©Êéò„ÇäÊé°Êéò„ÅÆÂ†¥Âêà„ÅØ„ÇØ„É™„ÉÉ„ÇØÂèØËÉΩ„Å´„Åô„Çã
                if (item === 'Èú≤Â§©Êéò„ÇäÊé°Êéò') {
                    subItem.classList.add('clickable-sub-item');
                    subItem.style.position = 'relative';
                    subItem.addEventListener('click', (e) => {
                        e.stopPropagation(); // Ë¶™Ë¶ÅÁ¥†„ÅÆ„Ç§„Éô„É≥„Éà„ÇíÈò≤„Åê
                        showActivityModal(item);
                    });
                }
                
                subItem.textContent = item;
                content.appendChild(subItem);
            });
            
            area.appendChild(content);
            
            return area;
        }
        
        // Ë©≥Á¥∞ÁîªÈù¢„Å´ÈÅ∑Áßª
        function navigateToDetail(areaKey) {
            if (areaHierarchy[areaKey]) {
                currentLevel = areaKey;
                breadcrumb.push(areaHierarchy[areaKey].title);
                
                // „Éï„Çß„Éº„Éâ„Ç¢„Ç¶„Éà ‚Üí „Éï„Çß„Éº„Éâ„Ç§„É≥
                const mainArea = document.getElementById('mainArea');
                mainArea.classList.remove('active');
                
                setTimeout(() => {
                    renderCurrentLevel();
                    mainArea.classList.add('active');
                }, 300);
            }
        }
        
        // Êàª„Çã
        function goBack() {
            if (currentLevel !== 'main') {
                const parentLevel = areaHierarchy[currentLevel].parent || 'main';
                currentLevel = parentLevel;
                breadcrumb.pop();
                
                // „Éï„Çß„Éº„Éâ„Ç¢„Ç¶„Éà ‚Üí „Éï„Çß„Éº„Éâ„Ç§„É≥
                const mainArea = document.getElementById('mainArea');
                mainArea.classList.remove('active');
                
                setTimeout(() => {
                    renderCurrentLevel();
                    mainArea.classList.add('active');
                }, 300);
            }
        }
        
        // „Ç®„É™„Ç¢ÊÉÖÂ†±Ë°®Á§∫
        function showAreaInfo(areaKey) {
            const infoContent = document.getElementById('infoContentTop');
            const infoTitle = document.querySelector('#infoPanelTop .info-title');
            
            // „É°„Ç§„É≥„É¨„Éô„É´„Åß„ÅØÂØæÂøú„Åô„Çã„Ç≠„Éº„ÇíÂ§âÊèõ
            let infoKey = areaKey;
            if (currentLevel === 'main') {
                const keyMapping = {
                    'primary_production': 'primary',
                    'secondary_production': 'secondary',
                    'alloys': 'alloys',
                    'processing': 'processing',
                    'products': 'products'
                };
                infoKey = keyMapping[areaKey] || areaKey;
            }
            
            if (areaInfo[infoKey]) {
                infoTitle.textContent = areaInfo[infoKey].title;
                infoContent.innerHTML = areaInfo[infoKey].content;
            } else {
                infoTitle.textContent = '„Ç®„É™„Ç¢ÊÉÖÂ†±';
                infoContent.innerHTML = '„Åì„ÅÆ„Ç®„É™„Ç¢„ÅÆË©≥Á¥∞ÊÉÖÂ†±„ÅØÊ∫ñÂÇô‰∏≠„Åß„Åô„ÄÇ';
            }
        }
        
        // „Éá„Éï„Ç©„É´„ÉàÊÉÖÂ†±Ë°®Á§∫
        function showDefaultInfo() {
            const infoContent = document.getElementById('infoContentTop');
            const infoTitle = document.querySelector('#infoPanelTop .info-title');
            
            infoTitle.textContent = '„Ç®„É™„Ç¢ÊÉÖÂ†±';
            if (currentLevel === 'main') {
                infoContent.innerHTML = `ÂêÑ„Ç®„É™„Ç¢„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶Ë©≥Á¥∞ÊÉÖÂ†±„ÇíË°®Á§∫„Åô„Çã„Åã„ÄÅË©≥Á¥∞„Ç®„É™„Ç¢„Å´ÁßªÂãï„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ<br>
                „Åì„ÅÆÂõ≥„ÅØ„ÄÅecoinvent„Éá„Éº„Çø„Éô„Éº„Çπ„Å´„Åä„Åë„Çã„Ç¢„É´„Éü„Éã„Ç¶„É†Èñ¢ÈÄ£„Éó„É≠„Çª„Çπ„ÇíÂú∞ÁêÜÁöÑ„Ç®„É™„Ç¢„ÅÆ„Çà„ÅÜ„Å´Ë°®Áèæ„Åó„ÄÅ
                „Åù„Çå„Åû„Çå„ÅÆÈ†òÂüüÂÜÖ„Å´Èñ¢ÈÄ£„Åô„Çã„Éó„É≠„Çª„Çπ„ÇÑ„Ç´„ÉÜ„Ç¥„É™„Çí„Ç∞„É´„Éº„ÉóÂåñ„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ`;
            } else {
                infoContent.innerHTML = `ÂêÑ„Ç®„É™„Ç¢„Çí„ÇØ„É™„ÉÉ„ÇØ„Åæ„Åü„ÅØ„Éõ„Éê„Éº„Åó„Å¶Ë©≥Á¥∞ÊÉÖÂ†±„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ<br>
                „Åì„ÅÆ„É¨„Éô„É´„Åß„ÅØ„ÄÅ„Çà„ÇäÂÖ∑‰ΩìÁöÑ„Å™„Éó„É≠„Çª„Çπ„ÇÑ„Ç´„ÉÜ„Ç¥„É™„ÅÆË©≥Á¥∞„ÇíË°®Á§∫„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ`;
            }
        }
        
        // Âá°‰æãÊõ¥Êñ∞
        function updateLegend(areas) {
            const legendContent = document.getElementById('legendContent');
            legendContent.innerHTML = '';
            
            Object.values(areas).forEach(areaData => {
                const legendItem = document.createElement('div');
                legendItem.className = 'legend-item';
                
                const colorBox = document.createElement('div');
                colorBox.className = 'legend-color';
                colorBox.style.background = areaData.legend_color;
                
                const text = document.createElement('span');
                text.className = 'legend-text';
                text.textContent = areaData.name.replace('„Ç®„É™„Ç¢', '');
                
                legendItem.appendChild(colorBox);
                legendItem.appendChild(text);
                legendContent.appendChild(legendItem);
            });
        }
        
        // „Éë„É≥„Åè„ÅöÊõ¥Êñ∞
        function updateBreadcrumb() {
            const breadcrumbContainer = document.getElementById('breadcrumb');
            breadcrumbContainer.innerHTML = '';
            
            breadcrumb.forEach((item, index) => {
                const breadcrumbItem = document.createElement('span');
                breadcrumbItem.className = 'breadcrumb-item';
                breadcrumbItem.textContent = item;
                
                if (index < breadcrumb.length - 1) {
                    breadcrumbItem.classList.add('clickable');
                    breadcrumbItem.addEventListener('click', () => {
                        // „Éë„É≥„Åè„Åö„ÇØ„É™„ÉÉ„ÇØ„ÅßË©≤ÂΩì„É¨„Éô„É´„Å´Êàª„Çã
                        if (index === 0) {
                            currentLevel = 'main';
                            breadcrumb = ['„Ç¢„É´„Éü„Éã„Ç¶„É†ÂÖ®‰Ωì'];
                        }
                        renderCurrentLevel();
                    });
                }
                
                breadcrumbContainer.appendChild(breadcrumbItem);
            });
        }
        
        // ÂàùÊúü„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥
        function initializeAnimation() {
            const areas = document.querySelectorAll('.area');
            areas.forEach((area, index) => {
                area.style.opacity = '0';
                area.style.transform += ' scale(0.8)';
                setTimeout(() => {
                    area.style.transition = 'all 0.6s ease';
                    area.style.opacity = '1';
                    area.style.transform = area.style.transform.replace('scale(0.8)', 'scale(1)');
                }, index * 200 + 500);
            });
        }
        
        // „É¨„É≥„ÉÄ„É™„É≥„Ç∞Âæå„Å´„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ÂÆüË°å
        setTimeout(initializeAnimation, 100);
        
        // Activity Modal Èñ¢ÈÄ£Èñ¢Êï∞
        function showActivityModal(itemName) {
            const modal = document.getElementById('activityModal');
            const modalTitle = document.getElementById('modalTitle');
            const activityList = document.getElementById('activityList');
            
            if (activityData[itemName]) {
                const data = activityData[itemName];
                modalTitle.textContent = data.title;
                
                // Activity‰∏ÄË¶ß„ÇíÁîüÊàê
                activityList.innerHTML = '';
                data.activities.forEach(activity => {
                    const activityElement = document.createElement('div');
                    activityElement.className = 'activity-item';
                    
                    activityElement.innerHTML = `
                        <div class="activity-id">${activity.id}</div>
                        <div class="activity-name">${activity.name}</div>
                        <div class="activity-description">${activity.description}</div>
                    `;
                    
                    activityList.appendChild(activityElement);
                });
                
                modal.style.display = 'block';
                document.body.style.overflow = 'hidden'; // „Çπ„ÇØ„É≠„Éº„É´ÁÑ°ÂäπÂåñ
            }
        }
        
        function closeActivityModal() {
            const modal = document.getElementById('activityModal');
            modal.style.display = 'none';
            document.body.style.overflow = 'auto'; // „Çπ„ÇØ„É≠„Éº„É´ÊúâÂäπÂåñ
        }
        
        // „É¢„Éº„ÉÄ„É´Â§ñ„ÇØ„É™„ÉÉ„ÇØ„ÅßÈñâ„Åò„Çã
        document.getElementById('activityModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeActivityModal();
            }
        });
        
        // ESC„Ç≠„Éº„ÅßÈñâ„Åò„Çã
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeActivityModal();
                closeSimilarityModal();
            }
        });
        
        // È°û‰ººÂ∫¶Ê§úÁ¥¢„É¢„Éº„ÉÄ„É´Èñ¢Êï∞
        function openSimilarityModal(areaKey) {
            const modal = document.getElementById('similarityModal');
            const title = document.getElementById('similarityModalTitle');
            title.textContent = '„Éú„Éº„Ç≠„Çµ„Ç§„ÉàÊé°Êéò - È°û‰ºº„Éó„É≠„Çª„ÇπÊ§úÁ¥¢';
            modal.style.display = 'block';
            document.body.style.overflow = 'hidden';
        }
        
        function closeSimilarityModal() {
            const modal = document.getElementById('similarityModal');
            modal.style.display = 'none';
            document.body.style.overflow = 'auto';
            // È°û‰ººÂ∫¶„Éê„ÉÉ„Ç∏„Çí„ÇØ„É™„Ç¢
            document.querySelectorAll('.similarity-badge').forEach(badge => badge.remove());
        }
        
        function searchSimilarProcesses() {
            const methodName = document.getElementById('miningMethodName').value;
            const depth = document.getElementById('miningDepth').value;
            const scale = document.getElementById('miningScale').value;
            
            if (!methodName) {
                alert('Êé°ÊéòÊñπÊ≥ïÂêç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }
            
            // ‰ªÆ„ÅÆÁâπÊÄßÂÄ§„ÇíË®≠ÂÆöÔºàÂÆüÈöõ„Å´„ÅØÂÖ•Âäõ„Éï„Ç©„Éº„É†„Åã„ÇâÂèñÂæóÔºâ
            const targetCharacteristics = {
                Ê∑±Â∫¶: depth,
                Áí∞Â¢ÉÂΩ±Èüø: depth === 'underwater' ? 90 : 60,
                „Ç≥„Çπ„Éà: scale === 'large' ? 80 : 50,
                ÁîüÁî£ÂäπÁéá: scale === 'large' ? 85 : 60,
                ÂÆâÂÖ®ÊÄß: depth === 'underwater' ? 40 : 70,
                „Ç®„Éç„É´„ÇÆ„ÉºÊ∂àË≤ª: depth === 'deep' ? 90 : 65
            };
            
            // È°û‰ººÂ∫¶Ë®àÁÆó
            const results = [];
            Object.keys(processSimilarityData['Êé°ÊéòÊñπÊ≥ï']).forEach(processName => {
                const similarity = calculateSimilarity(
                    targetCharacteristics,
                    processSimilarityData['Êé°ÊéòÊñπÊ≥ï'][processName]
                );
                results.push({
                    name: processName,
                    similarity: similarity,
                    data: processSimilarityData['Êé°ÊéòÊñπÊ≥ï'][processName]
                });
            });
            
            // ‰ªñ„ÅÆ„Ç´„ÉÜ„Ç¥„É™„Åã„Çâ„ÇÇÈ°û‰ºº„Éó„É≠„Çª„Çπ„ÇíÊé¢„ÅôÔºà‰æãÔºâ
            results.push({
                name: 'Ê©üÊ¢∞Âä†Â∑• (ÂàáÂâä„ÉªÁ†îÁ£®)',
                category: '„Ç¢„É´„Éü„Éã„Ç¶„É†Âä†Â∑•„Ç®„É™„Ç¢',
                similarity: {
                    total: 35,
                    details: {
                        Ê∑±Â∫¶: 0,
                        Áí∞Â¢ÉÂΩ±Èüø: 40,
                        „Ç≥„Çπ„Éà: 60,
                        ÁîüÁî£ÂäπÁéá: 50,
                        ÂÆâÂÖ®ÊÄß: 80,
                        „Ç®„Éç„É´„ÇÆ„ÉºÊ∂àË≤ª: 45
                    }
                },
                note: 'ÊùêÊñôÈô§Âéª„Éó„É≠„Çª„Çπ„Å®„Åó„Å¶„ÅÆÈ°û‰ººÊÄß'
            });
            
            // „Çπ„Ç≥„Ç¢È†Ü„Å´„ÇΩ„Éº„Éà
            results.sort((a, b) => b.similarity.total - a.similarity.total);
            
            // ÁµêÊûúË°®Á§∫
            displaySimilarityResults(methodName, results);
        }
        
        function displaySimilarityResults(targetMethod, results) {
            const resultsContainer = document.getElementById('similarityResults');
            resultsContainer.innerHTML = `
                <h3>„Äå${targetMethod}„Äç„Å´È°û‰ºº„Åô„Çã„Éó„É≠„Çª„Çπ</h3>
            `;
            
            results.forEach((result, index) => {
                const scoreClass = result.similarity.total >= 70 ? 'similarity-high' : 
                                  result.similarity.total >= 50 ? 'similarity-medium' : 'similarity-low';
                
                const resultItem = document.createElement('div');
                resultItem.className = 'similarity-result-item';
                resultItem.innerHTML = `
                    <h4>${result.name} ${result.category ? `Ôºà${result.category}Ôºâ` : ''}</h4>
                    <div class="similarity-score ${scoreClass}">${result.similarity.total}%</div>
                    ${result.note ? `<p style="color: #666; font-size: 14px; margin: 10px 0;">${result.note}</p>` : ''}
                    
                    <div class="similarity-details">
                        <h5>Ë©≥Á¥∞„Å™È°û‰ººÂ∫¶ÂàÜÊûê:</h5>
                        ${Object.keys(result.similarity.details).map(key => `
                            <div class="similarity-chart">
                                <div class="similarity-chart-label">${key}:</div>
                                <div class="similarity-chart-bar">
                                    <div class="similarity-chart-fill" style="width: ${result.similarity.details[key]}%"></div>
                                </div>
                                <div class="similarity-chart-value">${result.similarity.details[key]}%</div>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div style="margin-top: 15px; padding: 10px; background: #f0f8ff; border-radius: 5px; font-size: 13px;">
                        <strong>Êé®Â•®‰∫ãÈ†Ö:</strong> 
                        ${result.similarity.total >= 70 ? 
                            '„Åì„ÅÆ„Éó„É≠„Çª„Çπ„ÅÆ„Éá„Éº„Çø„Çª„ÉÉ„Éà„Çí‰ΩøÁî®„Åó„ÄÅÊ∑±Â∫¶„ÇÑË¶èÊ®°„ÅÆÂ∑ÆÁï∞„ÇíË£úÊ≠£‰øÇÊï∞„ÅßË™øÊï¥„Åô„Çã„Åì„Å®„ÇíÊé®Â•®„Åó„Åæ„Åô„ÄÇ' :
                            result.similarity.total >= 50 ?
                            '„Åì„ÅÆ„Éó„É≠„Çª„Çπ„ÇíÂèÇËÄÉ„Å´„Åó„Å§„Å§„ÄÅ‰∏ªË¶Å„Å™Â∑ÆÁï∞ÁÇπ„Å´„Å§„ÅÑ„Å¶ËøΩÂä†„ÅÆË™øÊüª„ÇÑÂ∞ÇÈñÄÂÆ∂„Å∏„ÅÆÁõ∏Ë´á„ÇíÊé®Â•®„Åó„Åæ„Åô„ÄÇ' :
                            'È°û‰ººÂ∫¶„Åå‰Ωé„ÅÑ„Åü„ÇÅ„ÄÅË§áÊï∞„ÅÆ„Éó„É≠„Çª„Çπ„ÇíÁµÑ„ÅøÂêà„Çè„Åõ„Çã„Åã„ÄÅÊñ∞Ë¶è„Éá„Éº„Çø„ÅÆÂèéÈõÜ„ÇíÊ§úË®é„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ'
                        }
                    </div>
                `;
                
                resultsContainer.appendChild(resultItem);
                
                // „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥
                setTimeout(() => {
                    resultItem.style.opacity = '0';
                    resultItem.style.transform = 'translateY(20px)';
                    requestAnimationFrame(() => {
                        resultItem.style.transition = 'all 0.5s ease';
                        resultItem.style.opacity = '1';
                        resultItem.style.transform = 'translateY(0)';
                    });
                }, index * 100);
            });
            
            // ÂÖÉ„ÅÆ„Ç®„É™„Ç¢„Å´È°û‰ººÂ∫¶„Éê„ÉÉ„Ç∏„ÇíË°®Á§∫
            closeSimilarityModal();
            showSimilarityBadges(results);
        }
        
        function showSimilarityBadges(results) {
            // ÁèæÂú®Ë°®Á§∫„Åï„Çå„Å¶„ÅÑ„Çã„Ç®„É™„Ç¢„Å´È°û‰ººÂ∫¶„Éê„ÉÉ„Ç∏„ÇíËøΩÂä†
            results.slice(0, 2).forEach(result => {
                const areas = document.querySelectorAll('.area');
                areas.forEach(area => {
                    const title = area.querySelector('.area-title');
                    if (title && title.textContent.includes(result.name)) {
                        const badge = document.createElement('div');
                        badge.className = 'similarity-badge';
                        const scoreClass = result.similarity.total >= 70 ? 'similarity-high' : 
                                          result.similarity.total >= 50 ? 'similarity-medium' : 'similarity-low';
                        badge.classList.add(scoreClass);
                        badge.textContent = `${result.similarity.total}% ‰∏ÄËá¥`;
                        area.appendChild(badge);
                    }
                });
            });
        }
        
        // ÊäΩË±°Ê§úÁ¥¢Ê©üËÉΩ
        const abstractSearchInput = document.getElementById('abstractSearchInput');
        const searchSuggestions = document.getElementById('searchSuggestions');
        
        // Ê§úÁ¥¢ÂÄôË£ú„ÇíË°®Á§∫
        abstractSearchInput.addEventListener('input', function(e) {
            const query = e.target.value.toLowerCase();
            if (query.length < 2) {
                searchSuggestions.style.display = 'none';
                return;
            }
            
            const matches = Object.keys(presetMixes).filter(key => 
                key.toLowerCase().includes(query)
            );
            
            if (matches.length > 0) {
                searchSuggestions.innerHTML = '';
                matches.forEach(match => {
                    const item = document.createElement('div');
                    item.className = 'suggestion-item';
                    item.textContent = match;
                    item.onclick = () => {
                        abstractSearchInput.value = match;
                        searchSuggestions.style.display = 'none';
                        performAbstractSearch();
                    };
                    searchSuggestions.appendChild(item);
                });
                searchSuggestions.style.display = 'block';
            } else {
                searchSuggestions.style.display = 'none';
            }
        });
        
        // ÊäΩË±°Ê§úÁ¥¢ÂÆüË°å
        function performAbstractSearch() {
            const query = abstractSearchInput.value;
            if (presetMixes[query]) {
                showMixComposition(query);
            } else {
                alert('Ë©≤ÂΩì„Åô„Çã„Éó„É™„Çª„ÉÉ„Éà„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„ÄÇÈ°û‰ºº„ÅÆÊ§úÁ¥¢Ë™û„Çí„ÅäË©¶„Åó„Åè„Å†„Åï„ÅÑ„ÄÇ');
            }
        }
        
        // „Éü„ÉÉ„ÇØ„ÇπÊßãÊàêË°®Á§∫
        function showMixComposition(mixName) {
            const mixData = presetMixes[mixName];
            
            // „É¢„Éº„ÉÄ„É´‰ΩúÊàê
            const modalOverlay = document.createElement('div');
            modalOverlay.className = 'modal-overlay';
            modalOverlay.style.display = 'block';
            modalOverlay.id = 'mixCompositionModal';
            
            const modal = document.createElement('div');
            modal.className = 'mix-composition-modal';
            
            modal.innerHTML = `
                <div class="modal-header">
                    <button class="modal-close" onclick="closeMixModal()">&times;</button>
                </div>
                
                <div class="mix-header">
                    <h2 class="mix-title">${mixData.name}</h2>
                    <p class="mix-subtitle">${mixData.description}</p>
                </div>
                
                <div class="preset-info">
                    <h4>„Éá„Éº„ÇøÊÉÖÂ†±</h4>
                    <p><strong>Âπ¥Â∫¶:</strong> ${mixData.year}Âπ¥</p>
                    <p><strong>Âá∫ÂÖ∏:</strong> ${mixData.source}</p>
                    <p><strong>ÊßãÊàêË¶ÅÁ¥†Êï∞:</strong> ${mixData.components.length}È†ÖÁõÆ</p>
                </div>
                
                <div class="mix-content">
                    <div class="mix-visualization">
                        <h3>ÊßãÊàêÊØîÁéá</h3>
                        <div class="mix-chart" id="mixChart">
                            <canvas id="pieChart" width="300" height="300"></canvas>
                        </div>
                    </div>
                    
                    <div class="mix-components">
                        <h3>ÊßãÊàêË¶ÅÁ¥†</h3>
                        <div id="componentsList">
                            ${mixData.components.map((comp, index) => `
                                <div class="component-item">
                                    <div class="component-info">
                                        <div class="component-name">${comp.name}</div>
                                        <div class="component-id">ID: ${comp.id}</div>
                                        <div style="font-size: 12px; color: #666; margin-top: 2px;">„Ç´„ÉÜ„Ç¥„É™: ${comp.category}</div>
                                    </div>
                                    <div class="component-actions">
                                        <span class="component-percentage">${comp.percentage}%</span>
                                        <input type="number" class="percentage-input" value="${comp.percentage}" 
                                               id="input-${index}" min="0" max="100" step="0.1"
                                               onchange="updatePercentage(${index})">
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        <div style="margin-top: 15px; padding: 10px; background: #f8f9fa; border-radius: 5px; text-align: center;">
                            <strong>ÂêàË®à: <span id="totalPercentage">100</span>%</strong>
                        </div>
                    </div>
                </div>
                
                <div class="mix-actions">
                    <button class="mix-action-btn btn-primary" onclick="applyMixComposition('${mixName}')">
                        „Åì„ÅÆÊßãÊàê„ÇíÈÅ©Áî®
                    </button>
                    <button class="mix-action-btn btn-secondary" onclick="exportMixComposition('${mixName}')">
                        ÊßãÊàê„Çí„Ç®„ÇØ„Çπ„Éù„Éº„Éà
                    </button>
                    <button class="mix-action-btn btn-secondary" onclick="closeMixModal()">
                        „Ç≠„É£„É≥„Çª„É´
                    </button>
                </div>
            `;
            
            modalOverlay.appendChild(modal);
            document.body.appendChild(modalOverlay);
            document.body.style.overflow = 'hidden';
            
            // ÂÜÜ„Ç∞„É©„ÉïÊèèÁîª
            drawPieChart(mixData.components);
            
            // ÁèæÂú®„ÅÆÊßãÊàê„Éá„Éº„Çø„Çí‰øùÂ≠ò
            window.currentMixData = JSON.parse(JSON.stringify(mixData));
        }
        
        function drawPieChart(components) {
            const canvas = document.getElementById('pieChart');
            const ctx = canvas.getContext('2d');
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const radius = 120;
            
            // Ëâ≤„Éë„É¨„ÉÉ„Éà
            const colors = [
                '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF',
                '#FF9F40', '#FF6384', '#C9CBCF', '#4BC0C0', '#36A2EB'
            ];
            
            let currentAngle = -Math.PI / 2; // ‰∏ä„Åã„ÇâÈñãÂßã
            
            components.forEach((comp, index) => {
                const sliceAngle = (comp.percentage / 100) * 2 * Math.PI;
                
                // ÊâáÂΩ¢ÊèèÁîª
                ctx.beginPath();
                ctx.arc(centerX, centerY, radius, currentAngle, currentAngle + sliceAngle);
                ctx.lineTo(centerX, centerY);
                ctx.fillStyle = colors[index % colors.length];
                ctx.fill();
                
                // „É©„Éô„É´ÊèèÁîªÔºà5%‰ª•‰∏ä„ÅÆÂ†¥ÂêàÔºâ
                if (comp.percentage >= 5) {
                    const labelAngle = currentAngle + sliceAngle / 2;
                    const labelX = centerX + Math.cos(labelAngle) * (radius * 0.7);
                    const labelY = centerY + Math.sin(labelAngle) * (radius * 0.7);
                    
                    ctx.fillStyle = 'white';
                    ctx.font = 'bold 14px Arial';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillText(comp.percentage + '%', labelX, labelY);
                }
                
                currentAngle += sliceAngle;
            });
        }
        
        function updatePercentage(index) {
            const input = document.getElementById(`input-${index}`);
            const newValue = parseFloat(input.value) || 0;
            window.currentMixData.components[index].percentage = newValue;
            
            // ÂêàË®à„ÇíÊõ¥Êñ∞
            const total = window.currentMixData.components.reduce((sum, comp) => sum + comp.percentage, 0);
            document.getElementById('totalPercentage').textContent = total.toFixed(1);
            
            // „Ç∞„É©„Éï„ÇíÂÜçÊèèÁîª
            const canvas = document.getElementById('pieChart');
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawPieChart(window.currentMixData.components);
        }
        
        function closeMixModal() {
            const modal = document.getElementById('mixCompositionModal');
            if (modal) {
                modal.remove();
                document.body.style.overflow = 'auto';
            }
        }
        
        function applyMixComposition(mixName) {
            const total = window.currentMixData.components.reduce((sum, comp) => sum + comp.percentage, 0);
            if (Math.abs(total - 100) > 0.1) {
                alert('ÊßãÊàêÊØî„ÅÆÂêàË®à„ÅØ100%„Åß„ÅÇ„ÇãÂøÖË¶Å„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇÁèæÂú®„ÅÆÂêàË®à: ' + total.toFixed(1) + '%');
                return;
            }
            
            alert(`„Äå${mixName}„Äç„ÅÆÊßãÊàê„ÅåÈÅ©Áî®„Åï„Çå„Åæ„Åó„Åü„ÄÇ\n\n` +
                  'ÈÅ©Áî®„Åï„Çå„ÅüÊßãÊàê:\n' +
                  window.currentMixData.components.map(comp => 
                      `${comp.name}: ${comp.percentage}%`
                  ).join('\n'));
            
            closeMixModal();
        }
        
        function exportMixComposition(mixName) {
            const exportData = {
                name: window.currentMixData.name,
                timestamp: new Date().toISOString(),
                components: window.currentMixData.components
            };
            
            const blob = new Blob([JSON.stringify(exportData, null, 2)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${mixName.replace(/\s+/g, '_')}_composition.json`;
            a.click();
            URL.revokeObjectURL(url);
        }
        
        // „ÇØ„É™„ÉÉ„ÇØÂ§ñ„Åß„Éâ„É≠„ÉÉ„Éó„ÉÄ„Ç¶„É≥„ÇíÈñâ„Åò„Çã
        document.addEventListener('click', function(e) {
            if (!abstractSearchInput.contains(e.target) && !searchSuggestions.contains(e.target)) {
                searchSuggestions.style.display = 'none';
            }
        });
    </script>
</body>
</html>
